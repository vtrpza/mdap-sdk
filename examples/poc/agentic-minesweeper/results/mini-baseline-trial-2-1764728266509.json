{
  "config": {
    "model": "gpt-4.1-mini",
    "useMdap": false,
    "k": 3,
    "temperature": 0.1,
    "maxSteps": 17,
    "outputDir": "/home/fatdog/Work/vibe/mdap-sdk/examples/poc/agentic-minesweeper/outputs",
    "trialId": "mini-baseline-trial-2-1764728266509"
  },
  "steps": [
    {
      "step": 1,
      "action": "Add these CSS styles:\n1. CSS reset: * { margin: 0;...",
      "code": "<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\" />\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\"/>\n  <title>Minesweeper</title>\n  <style>\n    * {\n      margin: 0;\n      padding: 0;\n      box-sizing: border-box;\n    }\n    body {\n      display: flex;\n      justify-content: center;\n      align-items: center;\n      background: #1a1a2e;\n      min-height: 100vh;\n      font-family: system-ui;\n    }\n    .container {\n      display: flex;\n      flex-direction: column;\n      align-items: center;\n      padding: 20px;\n    }\n    .header {\n      text-align: center;\n      margin-bottom: 20px;\n      color: white;\n    }\n  </style>\n</head>\n<body>\n  <script>\n  </script>\n</body>\n</html>",
      "samples": 1,
      "inputTokens": 552,
      "outputTokens": 209,
      "timeMs": 2810
    },
    {
      "step": 2,
      "action": "Add these CSS styles:\n1. h1: font-size 2.5rem, mar...",
      "code": "<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\" />\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\"/>\n  <title>Minesweeper</title>\n  <style>\n    * {\n      margin: 0;\n      padding: 0;\n      box-sizing: border-box;\n    }\n    body {\n      display: flex;\n      justify-content: center;\n      align-items: center;\n      background: #1a1a2e;\n      min-height: 100vh;\n      font-family: system-ui;\n    }\n    .container {\n      display: flex;\n      flex-direction: column;\n      align-items: center;\n      padding: 20px;\n    }\n    .header {\n      text-align: center;\n      margin-bottom: 20px;\n      color: white;\n    }\n    h1 {\n      font-size: 2.5rem;\n      margin-bottom: 10px;\n      text-shadow: 0 0 10px cyan;\n    }\n    .stats {\n      display: flex;\n      gap: 30px;\n      font-size: 1.2rem;\n    }\n    .stat {\n      display: flex;\n      align-items: center;\n      gap: 8px;\n    }\n    .stat-value {\n      font-weight: bold;\n      min-width: 40px;\n    }\n  </style>\n</head>\n<body>\n  <script>\n  </script>\n</body>\n</html>",
      "samples": 1,
      "inputTokens": 667,
      "outputTokens": 319,
      "timeMs": 5918
    },
    {
      "step": 3,
      "action": "Add these CSS styles:\n1. .grid: display grid, grid...",
      "code": "<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\" />\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\"/>\n  <title>Minesweeper</title>\n  <style>\n    * {\n      margin: 0;\n      padding: 0;\n      box-sizing: border-box;\n    }\n    body {\n      display: flex;\n      justify-content: center;\n      align-items: center;\n      background: #1a1a2e;\n      min-height: 100vh;\n      font-family: system-ui;\n    }\n    .container {\n      display: flex;\n      flex-direction: column;\n      align-items: center;\n      padding: 20px;\n    }\n    .header {\n      text-align: center;\n      margin-bottom: 20px;\n      color: white;\n    }\n    h1 {\n      font-size: 2.5rem;\n      margin-bottom: 10px;\n      text-shadow: 0 0 10px cyan;\n    }\n    .stats {\n      display: flex;\n      gap: 30px;\n      font-size: 1.2rem;\n    }\n    .stat {\n      display: flex;\n      align-items: center;\n      gap: 8px;\n    }\n    .stat-value {\n      font-weight: bold;\n      min-width: 40px;\n    }\n    .grid {\n      display: grid;\n      grid-template-columns: repeat(16, 1fr);\n      gap: 2px;\n      background: #0f0f1a;\n      padding: 10px;\n      border-radius: 8px;\n      box-shadow: 0 0 20px rgba(0,255,255,0.1);\n    }\n    .cell {\n      width: 28px;\n      height: 28px;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      font-weight: bold;\n      cursor: pointer;\n      border-radius: 4px;\n      transition: all 0.15s;\n      user-select: none;\n      font-family: monospace;\n      font-size: 16px;\n    }\n    .cell.hidden {\n      background: linear-gradient(145deg, #3a3a5c, #2a2a4c);\n    }\n    .cell.hidden:hover {\n      background: #4a4a6c;\n      transform: scale(1.05);\n    }\n  </style>\n</head>\n<body>\n  <script>\n  </script>\n</body>\n</html>",
      "samples": 1,
      "inputTokens": 855,
      "outputTokens": 546,
      "timeMs": 7495
    },
    {
      "step": 4,
      "action": "Add these CSS styles:\n1. .cell.revealed: backgroun...",
      "code": "<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\" />\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\"/>\n  <title>Minesweeper</title>\n  <style>\n    * {\n      margin: 0;\n      padding: 0;\n      box-sizing: border-box;\n    }\n    body {\n      display: flex;\n      justify-content: center;\n      align-items: center;\n      background: #1a1a2e;\n      min-height: 100vh;\n      font-family: system-ui;\n    }\n    .container {\n      display: flex;\n      flex-direction: column;\n      align-items: center;\n      padding: 20px;\n    }\n    .header {\n      text-align: center;\n      margin-bottom: 20px;\n      color: white;\n    }\n    h1 {\n      font-size: 2.5rem;\n      margin-bottom: 10px;\n      text-shadow: 0 0 10px cyan;\n    }\n    .stats {\n      display: flex;\n      gap: 30px;\n      font-size: 1.2rem;\n    }\n    .stat {\n      display: flex;\n      align-items: center;\n      gap: 8px;\n    }\n    .stat-value {\n      font-weight: bold;\n      min-width: 40px;\n    }\n    .grid {\n      display: grid;\n      grid-template-columns: repeat(16, 1fr);\n      gap: 2px;\n      background: #0f0f1a;\n      padding: 10px;\n      border-radius: 8px;\n      box-shadow: 0 0 20px rgba(0,255,255,0.1);\n      user-select: none;\n    }\n    .cell {\n      width: 28px;\n      height: 28px;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      font-weight: bold;\n      cursor: pointer;\n      border-radius: 4px;\n      transition: all 0.15s;\n      user-select: none;\n      font-family: monospace;\n      font-size: 16px;\n    }\n    .cell.hidden {\n      background: linear-gradient(145deg, #3a3a5c, #2a2a4c);\n    }\n    .cell.hidden:hover {\n      background: #4a4a6c;\n      transform: scale(1.05);\n    }\n    .cell.revealed {\n      background: #1a1a2e;\n      cursor: default;\n      box-shadow: inset 0 0 5px #00000088;\n    }\n    .cell.flagged {\n      background: #4a3a5c;\n      color: #f1c40f;\n      cursor: pointer;\n      text-shadow: 0 0 3px #f1c40f;\n    }\n    .cell.mine {\n      background: #ff4757;\n      color: white;\n      cursor: default;\n      box-shadow: inset 0 0 5px #b03a47;\n    }\n    .n1 { color: #3498db; }\n    .n2 { color: #2ecc71; }\n    .n3 { color: #e74c3c; }\n    .n4 { color: #9b59b6; }\n    .n5 { color: #e67e22; }\n    .n6 { color: #1abc9c; }\n    .n7 { color: #34495e; }\n    .n8 { color: #7f8c8d; }\n  </style>\n</head>\n<body>\n  <script>\n  </script>\n</body>\n</html>",
      "samples": 1,
      "inputTokens": 1076,
      "outputTokens": 802,
      "timeMs": 9482
    },
    {
      "step": 5,
      "action": "Add these CSS styles:\n1. .controls: margin-top 20p...",
      "code": "<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\" />\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\"/>\n  <title>Minesweeper</title>\n  <style>\n    * {\n      margin: 0;\n      padding: 0;\n      box-sizing: border-box;\n    }\n    body {\n      display: flex;\n      justify-content: center;\n      align-items: center;\n      background: #1a1a2e;\n      min-height: 100vh;\n      font-family: system-ui;\n    }\n    .container {\n      display: flex;\n      flex-direction: column;\n      align-items: center;\n      padding: 20px;\n    }\n    .header {\n      text-align: center;\n      margin-bottom: 20px;\n      color: white;\n    }\n    h1 {\n      font-size: 2.5rem;\n      margin-bottom: 10px;\n      text-shadow: 0 0 10px cyan;\n    }\n    .stats {\n      display: flex;\n      gap: 30px;\n      font-size: 1.2rem;\n    }\n    .stat {\n      display: flex;\n      align-items: center;\n      gap: 8px;\n    }\n    .stat-value {\n      font-weight: bold;\n      min-width: 40px;\n    }\n    .grid {\n      display: grid;\n      grid-template-columns: repeat(16, 1fr);\n      gap: 2px;\n      background: #0f0f1a;\n      padding: 10px;\n      border-radius: 8px;\n      box-shadow: 0 0 20px rgba(0,255,255,0.1);\n      user-select: none;\n    }\n    .cell {\n      width: 28px;\n      height: 28px;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      font-weight: bold;\n      cursor: pointer;\n      border-radius: 4px;\n      transition: all 0.15s;\n      user-select: none;\n      font-family: monospace;\n      font-size: 16px;\n    }\n    .cell.hidden {\n      background: linear-gradient(145deg, #3a3a5c, #2a2a4c);\n    }\n    .cell.hidden:hover {\n      background: #4a4a6c;\n      transform: scale(1.05);\n    }\n    .cell.revealed {\n      background: #1a1a2e;\n      cursor: default;\n      box-shadow: inset 0 0 5px #00000088;\n    }\n    .cell.flagged {\n      background: #4a3a5c;\n      color: #f1c40f;\n      cursor: pointer;\n      text-shadow: 0 0 3px #f1c40f;\n    }\n    .cell.mine {\n      background: #ff4757;\n      color: white;\n      cursor: default;\n      box-shadow: inset 0 0 5px #b03a47;\n    }\n    .n1 { color: #3498db; }\n    .n2 { color: #2ecc71; }\n    .n3 { color: #e74c3c; }\n    .n4 { color: #9b59b6; }\n    .n5 { color: #e67e22; }\n    .n6 { color: #1abc9c; }\n    .n7 { color: #34495e; }\n    .n8 { color: #7f8c8d; }\n\n    .controls {\n      margin-top: 20px;\n      display: flex;\n      gap: 15px;\n    }\n    button {\n      padding: 12px 24px;\n      font-size: 1rem;\n      border: none;\n      border-radius: 6px;\n      cursor: pointer;\n      background: #4a4a7c;\n      color: white;\n      transition: all 0.2s;\n    }\n    button:hover {\n      background: #5a5a9c;\n      transform: translateY(-2px);\n    }\n    #message {\n      position: fixed;\n      top: 50%;\n      left: 50%;\n      transform: translate(-50%, -50%);\n      padding: 30px 50px;\n      border-radius: 12px;\n      font-size: 2rem;\n      font-weight: bold;\n      z-index: 100;\n      display: none;\n    }\n  </style>\n</head>\n<body>\n  <script>\n  </script>\n</body>\n</html>",
      "samples": 1,
      "inputTokens": 1320,
      "outputTokens": 998,
      "timeMs": 13462
    },
    {
      "step": 6,
      "action": "Add these CSS styles:\n1. #message.show: display bl...",
      "code": "<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\" />\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\"/>\n  <title>Minesweeper</title>\n  <style>\n    * {\n      margin: 0;\n      padding: 0;\n      box-sizing: border-box;\n    }\n    body {\n      display: flex;\n      justify-content: center;\n      align-items: center;\n      background: #1a1a2e;\n      min-height: 100vh;\n      font-family: system-ui;\n    }\n    .container {\n      display: flex;\n      flex-direction: column;\n      align-items: center;\n      padding: 20px;\n    }\n    .header {\n      text-align: center;\n      margin-bottom: 20px;\n      color: white;\n    }\n    h1 {\n      font-size: 2.5rem;\n      margin-bottom: 10px;\n      text-shadow: 0 0 10px cyan;\n    }\n    .stats {\n      display: flex;\n      gap: 30px;\n      font-size: 1.2rem;\n    }\n    .stat {\n      display: flex;\n      align-items: center;\n      gap: 8px;\n    }\n    .stat-value {\n      font-weight: bold;\n      min-width: 40px;\n    }\n    .grid {\n      display: grid;\n      grid-template-columns: repeat(16, 1fr);\n      gap: 2px;\n      background: #0f0f1a;\n      padding: 10px;\n      border-radius: 8px;\n      box-shadow: 0 0 20px rgba(0,255,255,0.1);\n      user-select: none;\n    }\n    .cell {\n      width: 28px;\n      height: 28px;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      font-weight: bold;\n      cursor: pointer;\n      border-radius: 4px;\n      transition: all 0.15s;\n      user-select: none;\n      font-family: monospace;\n      font-size: 16px;\n    }\n    .cell.hidden {\n      background: linear-gradient(145deg, #3a3a5c, #2a2a4c);\n    }\n    .cell.hidden:hover {\n      background: #4a4a6c;\n      transform: scale(1.05);\n    }\n    .cell.revealed {\n      background: #1a1a2e;\n      cursor: default;\n      box-shadow: inset 0 0 5px #00000088;\n    }\n    .cell.flagged {\n      background: #4a3a5c;\n      color: #f1c40f;\n      cursor: pointer;\n      text-shadow: 0 0 3px #f1c40f;\n    }\n    .cell.mine {\n      background: #ff4757;\n      color: white;\n      cursor: default;\n      box-shadow: inset 0 0 5px #b03a47;\n    }\n    .n1 { color: #3498db; }\n    .n2 { color: #2ecc71; }\n    .n3 { color: #e74c3c; }\n    .n4 { color: #9b59b6; }\n    .n5 { color: #e67e22; }\n    .n6 { color: #1abc9c; }\n    .n7 { color: #34495e; }\n    .n8 { color: #7f8c8d; }\n\n    .controls {\n      margin-top: 20px;\n      display: flex;\n      gap: 15px;\n    }\n    button {\n      padding: 12px 24px;\n      font-size: 1rem;\n      border: none;\n      border-radius: 6px;\n      cursor: pointer;\n      background: #4a4a7c;\n      color: white;\n      transition: all 0.2s;\n    }\n    button:hover {\n      background: #5a5a9c;\n      transform: translateY(-2px);\n    }\n    #message {\n      position: fixed;\n      top: 50%;\n      left: 50%;\n      transform: translate(-50%, -50%);\n      padding: 30px 50px;\n      border-radius: 12px;\n      font-size: 2rem;\n      font-weight: bold;\n      z-index: 100;\n      display: none;\n    }\n    #message.show {\n      display: block;\n      animation: fadeIn 0.3s;\n    }\n    #message.win {\n      background: #2ed573;\n      color: white;\n    }\n    #message.lose {\n      background: #ff4757;\n      color: white;\n    }\n    @keyframes fadeIn {\n      from {\n        opacity: 0;\n        transform: translate(-50%, -50%) scale(0.8);\n      }\n      to {\n        opacity: 1;\n        transform: translate(-50%, -50%) scale(1);\n      }\n    }\n  </style>\n</head>\n<body>\n  <script>\n  </script>\n</body>\n</html>",
      "samples": 1,
      "inputTokens": 1472,
      "outputTokens": 1123,
      "timeMs": 14238
    },
    {
      "step": 7,
      "action": "Add these JavaScript variables at the start of the...",
      "code": "<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\" />\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\"/>\n  <title>Minesweeper</title>\n  <style>\n    * {\n      margin: 0;\n      padding: 0;\n      box-sizing: border-box;\n    }\n    body {\n      display: flex;\n      justify-content: center;\n      align-items: center;\n      background: #1a1a2e;\n      min-height: 100vh;\n      font-family: system-ui;\n    }\n    .container {\n      display: flex;\n      flex-direction: column;\n      align-items: center;\n      padding: 20px;\n      width: 100%;\n      max-width: 600px;\n    }\n    .header {\n      text-align: center;\n      margin-bottom: 20px;\n      color: white;\n      user-select: none;\n    }\n    h1 {\n      font-size: 2.5rem;\n      margin-bottom: 10px;\n      text-shadow: 0 0 10px cyan;\n    }\n    .stats {\n      display: flex;\n      gap: 30px;\n      font-size: 1.2rem;\n      justify-content: center;\n      margin-bottom: 10px;\n    }\n    .stat {\n      display: flex;\n      align-items: center;\n      gap: 8px;\n    }\n    .stat-value {\n      font-weight: bold;\n      min-width: 40px;\n      text-align: center;\n      font-family: monospace;\n    }\n    .grid {\n      display: grid;\n      grid-template-columns: repeat(16, 1fr);\n      gap: 2px;\n      background: #0f0f1a;\n      padding: 10px;\n      border-radius: 8px;\n      box-shadow: 0 0 20px rgba(0,255,255,0.1);\n      user-select: none;\n      width: 100%;\n      max-width: 448px;\n    }\n    .cell {\n      width: 28px;\n      height: 28px;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      font-weight: bold;\n      cursor: pointer;\n      border-radius: 4px;\n      transition: all 0.15s;\n      user-select: none;\n      font-family: monospace;\n      font-size: 16px;\n      line-height: 1;\n    }\n    .cell.hidden {\n      background: linear-gradient(145deg, #3a3a5c, #2a2a4c);\n    }\n    .cell.hidden:hover {\n      background: #4a4a6c;\n      transform: scale(1.05);\n    }\n    .cell.revealed {\n      background: #1a1a2e;\n      cursor: default;\n      box-shadow: inset 0 0 5px #00000088;\n      color: inherit;\n    }\n    .cell.flagged {\n      background: #4a3a5c;\n      color: #f1c40f;\n      cursor: pointer;\n      text-shadow: 0 0 3px #f1c40f;\n    }\n    .cell.mine {\n      background: #ff4757;\n      color: white;\n      cursor: default;\n      box-shadow: inset 0 0 5px #b03a47;\n    }\n    .n1 { color: #3498db; }\n    .n2 { color: #2ecc71; }\n    .n3 { color: #e74c3c; }\n    .n4 { color: #9b59b6; }\n    .n5 { color: #e67e22; }\n    .n6 { color: #1abc9c; }\n    .n7 { color: #34495e; }\n    .n8 { color: #7f8c8d; }\n\n    .controls {\n      margin-top: 20px;\n      display: flex;\n      gap: 15px;\n      justify-content: center;\n      width: 100%;\n      max-width: 448px;\n    }\n    button {\n      padding: 12px 24px;\n      font-size: 1rem;\n      border: none;\n      border-radius: 6px;\n      cursor: pointer;\n      background: #4a4a7c;\n      color: white;\n      transition: all 0.2s;\n      user-select: none;\n      flex: 1;\n    }\n    button:hover {\n      background: #5a5a9c;\n      transform: translateY(-2px);\n    }\n    #message {\n      position: fixed;\n      top: 50%;\n      left: 50%;\n      transform: translate(-50%, -50%);\n      padding: 30px 50px;\n      border-radius: 12px;\n      font-size: 2rem;\n      font-weight: bold;\n      z-index: 100;\n      display: none;\n      user-select: none;\n      text-align: center;\n      box-shadow: 0 0 20px rgba(0,0,0,0.5);\n      max-width: 90vw;\n      word-break: break-word;\n    }\n    #message.show {\n      display: block;\n      animation: fadeIn 0.3s;\n    }\n    #message.win {\n      background: #2ed573;\n      color: white;\n    }\n    #message.lose {\n      background: #ff4757;\n      color: white;\n    }\n    @keyframes fadeIn {\n      from {\n        opacity: 0;\n        transform: translate(-50%, -50%) scale(0.8);\n      }\n      to {\n        opacity: 1;\n        transform: translate(-50%, -50%) scale(1);\n      }\n    }\n  </style>\n</head>\n<body>\n  <div class=\"container\">\n    <div class=\"header\" aria-label=\"Minesweeper game header\">\n      <h1>Minesweeper</h1>\n      <div class=\"stats\" aria-live=\"polite\" aria-atomic=\"true\">\n        <div class=\"stat\" aria-label=\"Mines remaining\">\n          <span>üí£ Mines:</span>\n          <span id=\"mines-remaining\" class=\"stat-value\">40</span>\n        </div>\n        <div class=\"stat\" aria-label=\"Elapsed time in seconds\">\n          <span>‚è±Ô∏è Time:</span>\n          <span id=\"timer\" class=\"stat-value\">0</span>\n        </div>\n      </div>\n    </div>\n    <div class=\"grid\" role=\"grid\" aria-label=\"Minesweeper grid\" tabindex=\"0\"></div>\n    <div class=\"controls\">\n      <button id=\"new-game\" aria-label=\"Start a new game\">New Game</button>\n    </div>\n  </div>\n  <div id=\"message\" role=\"alert\" aria-live=\"assertive\"></div>\n  <script>\n    const GRID_SIZE = 16;\n    const MINE_COUNT = 40;\n    let grid = [];\n    let revealed = new Set();\n    let flagged = new Set();\n    let gameOver = false;\n    let gameWon = false;\n    let minesRemaining = MINE_COUNT;\n    let timerInterval = null;\n    let secondsElapsed = 0;\n    let firstClick = true;\n  </script>\n</body>\n</html>",
      "samples": 1,
      "inputTokens": 1572,
      "outputTokens": 1597,
      "timeMs": 17187
    },
    {
      "step": 8,
      "action": "Add this HTML structure inside body (before script...",
      "code": "<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\" />\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\"/>\n  <title>Minesweeper</title>\n  <style>\n    * {\n      margin: 0;\n      padding: 0;\n      box-sizing: border-box;\n    }\n    body {\n      display: flex;\n      justify-content: center;\n      align-items: center;\n      background: #1a1a2e;\n      min-height: 100vh;\n      font-family: system-ui;\n    }\n    .container {\n      display: flex;\n      flex-direction: column;\n      align-items: center;\n      padding: 20px;\n      width: 100%;\n      max-width: 600px;\n    }\n    .header {\n      text-align: center;\n      margin-bottom: 20px;\n      color: white;\n      user-select: none;\n    }\n    h1 {\n      font-size: 2.5rem;\n      margin-bottom: 10px;\n      text-shadow: 0 0 10px cyan;\n    }\n    .stats {\n      display: flex;\n      gap: 30px;\n      font-size: 1.2rem;\n      justify-content: center;\n      margin-bottom: 10px;\n    }\n    .stat {\n      display: flex;\n      align-items: center;\n      gap: 8px;\n      color: white;\n    }\n    .stat-icon {\n      font-size: 1.3rem;\n      user-select: none;\n    }\n    .stat-value {\n      font-weight: bold;\n      min-width: 40px;\n      text-align: center;\n      font-family: monospace;\n    }\n    .grid {\n      display: grid;\n      grid-template-columns: repeat(16, 1fr);\n      gap: 2px;\n      background: #0f0f1a;\n      padding: 10px;\n      border-radius: 8px;\n      box-shadow: 0 0 20px rgba(0,255,255,0.1);\n      user-select: none;\n      width: 100%;\n      max-width: 448px;\n    }\n    .cell {\n      width: 28px;\n      height: 28px;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      font-weight: bold;\n      cursor: pointer;\n      border-radius: 4px;\n      transition: all 0.15s;\n      user-select: none;\n      font-family: monospace;\n      font-size: 16px;\n      line-height: 1;\n    }\n    .cell.hidden {\n      background: linear-gradient(145deg, #3a3a5c, #2a2a4c);\n    }\n    .cell.hidden:hover {\n      background: #4a4a6c;\n      transform: scale(1.05);\n    }\n    .cell.revealed {\n      background: #1a1a2e;\n      cursor: default;\n      box-shadow: inset 0 0 5px #00000088;\n      color: inherit;\n    }\n    .cell.flagged {\n      background: #4a3a5c;\n      color: #f1c40f;\n      cursor: pointer;\n      text-shadow: 0 0 3px #f1c40f;\n    }\n    .cell.mine {\n      background: #ff4757;\n      color: white;\n      cursor: default;\n      box-shadow: inset 0 0 5px #b03a47;\n    }\n    .n1 { color: #3498db; }\n    .n2 { color: #2ecc71; }\n    .n3 { color: #e74c3c; }\n    .n4 { color: #9b59b6; }\n    .n5 { color: #e67e22; }\n    .n6 { color: #1abc9c; }\n    .n7 { color: #34495e; }\n    .n8 { color: #7f8c8d; }\n\n    .controls {\n      margin-top: 20px;\n      display: flex;\n      gap: 15px;\n      justify-content: center;\n      width: 100%;\n      max-width: 448px;\n    }\n    button {\n      padding: 12px 24px;\n      font-size: 1rem;\n      border: none;\n      border-radius: 6px;\n      cursor: pointer;\n      background: #4a4a7c;\n      color: white;\n      transition: all 0.2s;\n      user-select: none;\n      flex: 1;\n    }\n    button:hover {\n      background: #5a5a9c;\n      transform: translateY(-2px);\n    }\n    #message {\n      position: fixed;\n      top: 50%;\n      left: 50%;\n      transform: translate(-50%, -50%);\n      padding: 30px 50px;\n      border-radius: 12px;\n      font-size: 2rem;\n      font-weight: bold;\n      z-index: 100;\n      display: none;\n      user-select: none;\n      text-align: center;\n      box-shadow: 0 0 20px rgba(0,0,0,0.5);\n      max-width: 90vw;\n      word-break: break-word;\n    }\n    #message.show {\n      display: block;\n      animation: fadeIn 0.3s;\n    }\n    #message.win {\n      background: #2ed573;\n      color: white;\n    }\n    #message.lose {\n      background: #ff4757;\n      color: white;\n    }\n    @keyframes fadeIn {\n      from {\n        opacity: 0;\n        transform: translate(-50%, -50%) scale(0.8);\n      }\n      to {\n        opacity: 1;\n        transform: translate(-50%, -50%) scale(1);\n      }\n    }\n  </style>\n</head>\n<body>\n  <div class=\"container\">\n    <div class=\"header\">\n      <h1>Minesweeper</h1>\n      <div class=\"stats\">\n        <div class=\"stat\"><span class=\"stat-icon\">üí£</span><span id=\"mine-count\" class=\"stat-value\">40</span></div>\n        <div class=\"stat\"><span class=\"stat-icon\">‚è±Ô∏è</span><span id=\"timer\" class=\"stat-value\">00:00</span></div>\n      </div>\n    </div>\n    <div id=\"grid\" class=\"grid\"></div>\n    <div class=\"controls\">\n      <button id=\"new-game\">New Game</button>\n    </div>\n    <div id=\"message\"></div>\n  </div>\n  <script>\n    const GRID_SIZE = 16;\n    const MINE_COUNT = 40;\n    let grid = [];\n    let revealed = new Set();\n    let flagged = new Set();\n    let gameOver = false;\n    let gameWon = false;\n    let minesRemaining = MINE_COUNT;\n    let timerInterval = null;\n    let secondsElapsed = 0;\n    let firstClick = true;\n\n    const gridElement = document.getElementById('grid');\n    const mineCountElement = document.getElementById('mine-count');\n    const timerElement = document.getElementById('timer');\n    const messageElement = document.getElementById('message');\n    const newGameButton = document.getElementById('new-game');\n\n    function createGrid() {\n      grid = [];\n      revealed.clear();\n      flagged.clear();\n      gameOver = false;\n      gameWon = false;\n      minesRemaining = MINE_COUNT;\n      firstClick = true;\n      secondsElapsed = 0;\n      updateMineCount();\n      updateTimerDisplay();\n      clearInterval(timerInterval);\n      timerInterval = null;\n      messageElement.className = '';\n      messageElement.textContent = '';\n      messageElement.style.display = 'none';\n\n      gridElement.innerHTML = '';\n      gridElement.style.gridTemplateColumns = `repeat(${GRID_SIZE}, 1fr)`;\n\n      for (let i = 0; i < GRID_SIZE; i++) {\n        grid[i] = [];\n        for (let j = 0; j < GRID_SIZE; j++) {\n          const cell = {\n            row: i,\n            col: j,\n            mine: false,\n            adjacentMines: 0,\n            revealed: false,\n            flagged: false,\n            element: null\n          };\n          const cellElement = document.createElement('div');\n          cellElement.classList.add('cell', 'hidden');\n          cellElement.setAttribute('data-row', i);\n          cellElement.setAttribute('data-col', j);\n          cellElement.setAttribute('role', 'button');\n          cellElement.setAttribute('tabindex', '0');\n          cellElement.setAttribute('aria-label', 'Hidden cell');\n          cell.element = cellElement;\n          gridElement.appendChild(cellElement);\n          grid[i][j] = cell;\n        }\n      }\n    }\n\n    function placeMines(excludeRow, excludeCol) {\n      let minesPlaced = 0;\n      while (minesPlaced < MINE_COUNT) {\n        const r = Math.floor(Math.random() * GRID_SIZE);\n        const c = Math.floor(Math.random() * GRID_SIZE);\n        if (grid[r][c].mine) continue;\n        // Exclude the first clicked cell and neighbors to avoid immediate loss\n        if (Math.abs(r - excludeRow) <= 1 && Math.abs(c - excludeCol) <= 1) continue;\n        grid[r][c].mine = true;\n        minesPlaced++;\n      }\n    }\n\n    function calculateAdjacentMines() {\n      for (let i = 0; i < GRID_SIZE; i++) {\n        for (let j = 0; j < GRID_SIZE; j++) {\n          if (grid[i][j].mine) {\n            grid[i][j].adjacentMines = -1;\n            continue;\n          }\n          let count = 0;\n          for (let dr = -1; dr <= 1; dr++) {\n            for (let dc = -1; dc <= 1; dc++) {\n              if (dr === 0 && dc === 0) continue;\n              const nr = i + dr;\n              const nc = j + dc;\n              if (nr >= 0 && nr < GRID_SIZE && nc >= 0 && nc < GRID_SIZE) {\n                if (grid[nr][nc].mine) count++;\n              }\n            }\n          }\n          grid[i][j].adjacentMines = count;\n        }\n      }\n    }\n\n    function revealCell(row, col) {\n      const cell = grid[row][col];\n      if (gameOver || cell.revealed || cell.flagged) return;\n      cell.revealed = true;\n      revealed.add(`${row},${col}`);\n      cell.element.classList.remove('hidden', 'flagged');\n      cell.element.classList.add('revealed');\n      cell.element.setAttribute('aria-label', `Revealed cell with ${cell.adjacentMines} adjacent mines`);\n      if (cell.mine) {\n        cell.element.classList.add('mine');\n        endGame(false);\n        return;\n      }\n      if (cell.adjacentMines > 0) {\n        cell.element.textContent = cell.adjacentMines;\n        cell.element.classList.add('n' + cell.adjacentMines);\n      } else {\n        cell.element.textContent = '';\n        // Reveal neighbors recursively\n        for (let dr = -1; dr <= 1; dr++) {\n          for (let dc = -1; dc <= 1; dc++) {\n            if (dr === 0 && dc === 0) continue;\n            const nr = row + dr;\n            const nc = col + dc;\n            if (nr >= 0 && nr < GRID_SIZE && nc >= 0 && nc < GRID_SIZE) {\n              if (!grid[nr][nc].revealed && !grid[nr][nc].flagged) {\n                revealCell(nr, nc);\n              }\n            }\n          }\n        }\n      }\n      checkWin();\n    }\n\n    function toggleFlag(row, col) {\n      if (gameOver) return;\n      const cell = grid[row][col];\n      if (cell.revealed) return;\n      if (cell.flagged) {\n        cell.flagged = false;\n        flagged.delete(`${row},${col}`);\n        cell.element.classList.remove('flagged');\n        cell.element.classList.add('hidden');\n        cell.element.textContent = '';\n        minesRemaining++;\n      } else {\n        if (minesRemaining === 0) return; // no flags left\n        cell.flagged = true;\n        flagged.add(`${row},${col}`);\n        cell.element.classList.remove('hidden');\n        cell.element.classList.add('flagged');\n        cell.element.textContent = 'üö©';\n        minesRemaining--;\n      }\n      updateMineCount();\n      checkWin();\n    }\n\n    function updateMineCount() {\n      mineCountElement.textContent = minesRemaining.toString();\n    }\n\n    function updateTimerDisplay() {\n      const minutes = Math.floor(secondsElapsed / 60);\n      const seconds = secondsElapsed % 60;\n      timerElement.textContent = `${minutes.toString().padStart(2,'0')}:${seconds.toString().padStart(2,'0')}`;\n    }\n\n    function startTimer() {\n      if (timerInterval) return;\n      timerInterval = setInterval(() => {\n        secondsElapsed++;\n        updateTimerDisplay();\n      }, 1000);\n    }\n\n    function stopTimer() {\n      clearInterval(timerInterval);\n      timerInterval = null;\n    }\n\n    function endGame(won) {\n      gameOver = true;\n      gameWon = won;\n      stopTimer();\n      revealAllMines();\n      showMessage(won ? 'You Win! üéâ' : 'Game Over üí•', won ? 'win' : 'lose');\n    }\n\n    function revealAllMines() {\n      for (let i = 0; i < GRID_SIZE; i++) {\n        for (let j = 0; j < GRID_SIZE; j++) {\n          const cell = grid[i][j];\n          if (cell.mine && !cell.revealed) {\n            cell.element.classList.remove('hidden', 'flagged');\n            cell.element.classList.add('revealed', 'mine');\n            cell.element.textContent = 'üí£';\n            cell.revealed = true;\n          }\n          if (!cell.mine && cell.flagged) {\n            // Wrong flag\n            cell.element.classList.add('revealed');\n            cell.element.style.backgroundColor = '#e74c3c88';\n          }\n        }\n      }\n    }\n\n    function showMessage(text, type) {\n      messageElement.textContent = text;\n      messageElement.className = 'show ' + type;\n      messageElement.style.display = 'block';\n    }\n\n    function checkWin() {\n      if (gameOver) return;\n      // Win if all non-mine cells revealed\n      const totalCells = GRID_SIZE * GRID_SIZE;\n      if (revealed.size === totalCells - MINE_COUNT) {\n        endGame(true);\n      }\n    }\n\n    function onCellClick(e) {\n      if (gameOver) return;\n      const target = e.currentTarget;\n      const row = parseInt(target.getAttribute('data-row'));\n      const col = parseInt(target.getAttribute('data-col'));\n      if (e.button === 0) { // left click\n        if (firstClick) {\n          placeMines(row, col);\n          calculateAdjacentMines();\n          firstClick = false;\n          startTimer();\n        }\n        revealCell(row, col);\n      }\n    }\n\n    function onCellContextMenu(e) {\n      e.preventDefault();\n      if (gameOver) return;\n      const target = e.currentTarget;\n      const row = parseInt(target.getAttribute('data-row'));\n      const col = parseInt(target.getAttribute('data-col'));\n      if (firstClick) return; // no flags before first reveal\n      toggleFlag(row, col);\n    }\n\n    function onCellKeyDown(e) {\n      if (gameOver) return;\n      const target = e.currentTarget;\n      const row = parseInt(target.getAttribute('data-row'));\n      const col = parseInt(target.getAttribute('data-col'));\n      if (e.key === 'Enter' || e.key === ' ') {\n        e.preventDefault();\n        if (firstClick) {\n          placeMines(row, col);\n          calculateAdjacentMines();\n          firstClick = false;\n          startTimer();\n        }\n        revealCell(row, col);\n      } else if (e.key.toLowerCase() === 'f') {\n        e.preventDefault();\n        if (firstClick) return;\n        toggleFlag(row, col);\n      }\n    }\n\n    function addCellListeners(cell) {\n      cell.element.addEventListener('click', onCellClick);\n      cell.element.addEventListener('contextmenu', onCellContextMenu);\n      cell.element.addEventListener('keydown', onCellKeyDown);\n    }\n\n    function init() {\n      createGrid();\n      for (let i = 0; i < GRID_SIZE; i++) {\n        for (let j = 0; j < GRID_SIZE; j++) {\n          addCellListeners(grid[i][j]);\n        }\n      }\n      updateMineCount();\n      updateTimerDisplay();\n    }\n\n    newGameButton.addEventListener('click', () => {\n      init();\n    });\n\n    init();\n  </script>\n</body>\n</html>",
      "samples": 1,
      "inputTokens": 2135,
      "outputTokens": 3716,
      "timeMs": 48054
    },
    {
      "step": 9,
      "action": "Add these JavaScript utility functions:\nfunction g...",
      "code": "<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\" />\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\"/>\n  <title>Minesweeper</title>\n  <style>\n    * {\n      margin: 0;\n      padding: 0;\n      box-sizing: border-box;\n    }\n    body {\n      display: flex;\n      justify-content: center;\n      align-items: center;\n      background: #1a1a2e;\n      min-height: 100vh;\n      font-family: system-ui;\n    }\n    .container {\n      display: flex;\n      flex-direction: column;\n      align-items: center;\n      padding: 20px;\n      width: 100%;\n      max-width: 600px;\n    }\n    .header {\n      text-align: center;\n      margin-bottom: 20px;\n      color: white;\n      user-select: none;\n    }\n    h1 {\n      font-size: 2.5rem;\n      margin-bottom: 10px;\n      text-shadow: 0 0 10px cyan;\n    }\n    .stats {\n      display: flex;\n      gap: 30px;\n      font-size: 1.2rem;\n      justify-content: center;\n      margin-bottom: 10px;\n    }\n    .stat {\n      display: flex;\n      align-items: center;\n      gap: 8px;\n      color: white;\n    }\n    .stat-icon {\n      font-size: 1.3rem;\n      user-select: none;\n    }\n    .stat-value {\n      font-weight: bold;\n      min-width: 40px;\n      text-align: center;\n      font-family: monospace;\n    }\n    .grid {\n      display: grid;\n      grid-template-columns: repeat(16, 1fr);\n      gap: 2px;\n      background: #0f0f1a;\n      padding: 10px;\n      border-radius: 8px;\n      box-shadow: 0 0 20px rgba(0,255,255,0.1);\n      user-select: none;\n      width: 100%;\n      max-width: 448px;\n    }\n    .cell {\n      width: 28px;\n      height: 28px;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      font-weight: bold;\n      cursor: pointer;\n      border-radius: 4px;\n      transition: all 0.15s;\n      user-select: none;\n      font-family: monospace;\n      font-size: 16px;\n      line-height: 1;\n    }\n    .cell.hidden {\n      background: linear-gradient(145deg, #3a3a5c, #2a2a4c);\n    }\n    .cell.hidden:hover {\n      background: #4a4a6c;\n      transform: scale(1.05);\n    }\n    .cell.revealed {\n      background: #1a1a2e;\n      cursor: default;\n      box-shadow: inset 0 0 5px #00000088;\n      color: inherit;\n    }\n    .cell.flagged {\n      background: #4a3a5c;\n      color: #f1c40f;\n      cursor: pointer;\n      text-shadow: 0 0 3px #f1c40f;\n    }\n    .cell.mine {\n      background: #ff4757;\n      color: white;\n      cursor: default;\n      box-shadow: inset 0 0 5px #b03a47;\n    }\n    .n1 { color: #3498db; }\n    .n2 { color: #2ecc71; }\n    .n3 { color: #e74c3c; }\n    .n4 { color: #9b59b6; }\n    .n5 { color: #e67e22; }\n    .n6 { color: #1abc9c; }\n    .n7 { color: #34495e; }\n    .n8 { color: #7f8c8d; }\n\n    .controls {\n      margin-top: 20px;\n      display: flex;\n      gap: 15px;\n      justify-content: center;\n      width: 100%;\n      max-width: 448px;\n    }\n    button {\n      padding: 12px 24px;\n      font-size: 1rem;\n      border: none;\n      border-radius: 6px;\n      cursor: pointer;\n      background: #4a4a7c;\n      color: white;\n      transition: all 0.2s;\n      user-select: none;\n      flex: 1;\n    }\n    button:hover {\n      background: #5a5a9c;\n      transform: translateY(-2px);\n    }\n    #message {\n      position: fixed;\n      top: 50%;\n      left: 50%;\n      transform: translate(-50%, -50%);\n      padding: 30px 50px;\n      border-radius: 12px;\n      font-size: 2rem;\n      font-weight: bold;\n      z-index: 100;\n      display: none;\n      user-select: none;\n      text-align: center;\n      box-shadow: 0 0 20px rgba(0,0,0,0.5);\n      max-width: 90vw;\n      word-break: break-word;\n    }\n    #message.show {\n      display: block;\n      animation: fadeIn 0.3s;\n    }\n    #message.win {\n      background: #2ed573;\n      color: white;\n    }\n    #message.lose {\n      background: #ff4757;\n      color: white;\n    }\n    @keyframes fadeIn {\n      from {\n        opacity: 0;\n        transform: translate(-50%, -50%) scale(0.8);\n      }\n      to {\n        opacity: 1;\n        transform: translate(-50%, -50%) scale(1);\n      }\n    }\n  </style>\n</head>\n<body>\n  <div class=\"container\">\n    <div class=\"header\">\n      <h1>Minesweeper</h1>\n      <div class=\"stats\">\n        <div class=\"stat\"><span class=\"stat-icon\">üí£</span><span id=\"mine-count\" class=\"stat-value\">40</span></div>\n        <div class=\"stat\"><span class=\"stat-icon\">‚è±Ô∏è</span><span id=\"timer\" class=\"stat-value\">00:00</span></div>\n      </div>\n    </div>\n    <div id=\"grid\" class=\"grid\"></div>\n    <div class=\"controls\">\n      <button id=\"new-game\">New Game</button>\n    </div>\n    <div id=\"message\"></div>\n  </div>\n  <script>\n    const GRID_SIZE = 16;\n    const MINE_COUNT = 40;\n    let grid = [];\n    let revealed = new Set();\n    let flagged = new Set();\n    let gameOver = false;\n    let gameWon = false;\n    let minesRemaining = MINE_COUNT;\n    let timerInterval = null;\n    let secondsElapsed = 0;\n    let firstClick = true;\n\n    const gridElement = document.getElementById('grid');\n    const mineCountElement = document.getElementById('mine-count');\n    const timerElement = document.getElementById('timer');\n    const messageElement = document.getElementById('message');\n    const newGameButton = document.getElementById('new-game');\n\n    function getNeighbors(row, col) {\n      const neighbors = [];\n      for (let dr = -1; dr <= 1; dr++) {\n        for (let dc = -1; dc <= 1; dc++) {\n          if (dr === 0 && dc === 0) continue;\n          const nr = row + dr, nc = col + dc;\n          if (nr >= 0 && nr < GRID_SIZE && nc >= 0 && nc < GRID_SIZE) {\n            neighbors.push([nr, nc]);\n          }\n        }\n      }\n      return neighbors;\n    }\n\n    function getCell(row, col) {\n      return document.querySelector(`.cell[data-row=\"${row}\"][data-col=\"${col}\"]`);\n    }\n\n    function updateMineCount() {\n      document.getElementById('mine-count').textContent = minesRemaining;\n    }\n\n    function formatTime(secs) {\n      const m = Math.floor(secs / 60).toString().padStart(2, '0');\n      const s = (secs % 60).toString().padStart(2, '0');\n      return m + ':' + s;\n    }\n\n    function updateTimer() {\n      document.getElementById('timer').textContent = formatTime(secondsElapsed);\n    }\n\n    function startTimer() {\n      if (timerInterval) return;\n      timerInterval = setInterval(() => { secondsElapsed++; updateTimer(); }, 1000);\n    }\n\n    function stopTimer() {\n      if (timerInterval) { clearInterval(timerInterval); timerInterval = null; }\n    }\n\n    function createGrid() {\n      grid = [];\n      revealed.clear();\n      flagged.clear();\n      gameOver = false;\n      gameWon = false;\n      minesRemaining = MINE_COUNT;\n      firstClick = true;\n      secondsElapsed = 0;\n      updateMineCount();\n      updateTimer();\n      stopTimer();\n      messageElement.className = '';\n      messageElement.textContent = '';\n      messageElement.style.display = 'none';\n\n      gridElement.innerHTML = '';\n      gridElement.style.gridTemplateColumns = `repeat(${GRID_SIZE}, 1fr)`;\n\n      for (let i = 0; i < GRID_SIZE; i++) {\n        grid[i] = [];\n        for (let j = 0; j < GRID_SIZE; j++) {\n          const cell = {\n            row: i,\n            col: j,\n            mine: false,\n            adjacentMines: 0,\n            revealed: false,\n            flagged: false,\n            element: null\n          };\n          const cellElement = document.createElement('div');\n          cellElement.classList.add('cell', 'hidden');\n          cellElement.setAttribute('data-row', i);\n          cellElement.setAttribute('data-col', j);\n          cellElement.setAttribute('role', 'button');\n          cellElement.setAttribute('tabindex', '0');\n          cellElement.setAttribute('aria-label', 'Hidden cell');\n          cell.element = cellElement;\n          gridElement.appendChild(cellElement);\n          grid[i][j] = cell;\n        }\n      }\n    }\n\n    function placeMines(excludeRow, excludeCol) {\n      let minesPlaced = 0;\n      while (minesPlaced < MINE_COUNT) {\n        const r = Math.floor(Math.random() * GRID_SIZE);\n        const c = Math.floor(Math.random() * GRID_SIZE);\n        if (grid[r][c].mine) continue;\n        // Exclude the first clicked cell and neighbors to avoid immediate loss\n        if (Math.abs(r - excludeRow) <= 1 && Math.abs(c - excludeCol) <= 1) continue;\n        grid[r][c].mine = true;\n        minesPlaced++;\n      }\n    }\n\n    function calculateAdjacentMines() {\n      for (let i = 0; i < GRID_SIZE; i++) {\n        for (let j = 0; j < GRID_SIZE; j++) {\n          if (grid[i][j].mine) {\n            grid[i][j].adjacentMines = -1;\n            continue;\n          }\n          let count = 0;\n          for (let dr = -1; dr <= 1; dr++) {\n            for (let dc = -1; dc <= 1; dc++) {\n              if (dr === 0 && dc === 0) continue;\n              const nr = i + dr;\n              const nc = j + dc;\n              if (nr >= 0 && nr < GRID_SIZE && nc >= 0 && nc < GRID_SIZE) {\n                if (grid[nr][nc].mine) count++;\n              }\n            }\n          }\n          grid[i][j].adjacentMines = count;\n        }\n      }\n    }\n\n    function revealCell(row, col) {\n      const cell = grid[row][col];\n      if (gameOver || cell.revealed || cell.flagged) return;\n      cell.revealed = true;\n      revealed.add(`${row},${col}`);\n      cell.element.classList.remove('hidden', 'flagged');\n      cell.element.classList.add('revealed');\n      cell.element.setAttribute('aria-label', `Revealed cell with ${cell.adjacentMines} adjacent mines`);\n      if (cell.mine) {\n        cell.element.classList.add('mine');\n        endGame(false);\n        return;\n      }\n      if (cell.adjacentMines > 0) {\n        cell.element.textContent = cell.adjacentMines;\n        cell.element.classList.add('n' + cell.adjacentMines);\n      } else {\n        cell.element.textContent = '';\n        // Reveal neighbors recursively\n        for (let dr = -1; dr <= 1; dr++) {\n          for (let dc = -1; dc <= 1; dc++) {\n            if (dr === 0 && dc === 0) continue;\n            const nr = row + dr;\n            const nc = col + dc;\n            if (nr >= 0 && nr < GRID_SIZE && nc >= 0 && nc < GRID_SIZE) {\n              if (!grid[nr][nc].revealed && !grid[nr][nc].flagged) {\n                revealCell(nr, nc);\n              }\n            }\n          }\n        }\n      }\n      checkWin();\n    }\n\n    function toggleFlag(row, col) {\n      if (gameOver) return;\n      const cell = grid[row][col];\n      if (cell.revealed) return;\n      if (cell.flagged) {\n        cell.flagged = false;\n        flagged.delete(`${row},${col}`);\n        cell.element.classList.remove('flagged');\n        cell.element.classList.add('hidden');\n        cell.element.textContent = '';\n        minesRemaining++;\n      } else {\n        if (minesRemaining === 0) return; // no flags left\n        cell.flagged = true;\n        flagged.add(`${row},${col}`);\n        cell.element.classList.remove('hidden');\n        cell.element.classList.add('flagged');\n        cell.element.textContent = 'üö©';\n        minesRemaining--;\n      }\n      updateMineCount();\n      checkWin();\n    }\n\n    function endGame(won) {\n      gameOver = true;\n      gameWon = won;\n      stopTimer();\n      revealAllMines();\n      showMessage(won ? 'You Win! üéâ' : 'Game Over üí•', won ? 'win' : 'lose');\n    }\n\n    function revealAllMines() {\n      for (let i = 0; i < GRID_SIZE; i++) {\n        for (let j = 0; j < GRID_SIZE; j++) {\n          const cell = grid[i][j];\n          if (cell.mine && !cell.revealed) {\n            cell.element.classList.remove('hidden', 'flagged');\n            cell.element.classList.add('revealed', 'mine');\n            cell.element.textContent = 'üí£';\n            cell.revealed = true;\n          }\n          if (!cell.mine && cell.flagged) {\n            // Wrong flag\n            cell.element.classList.add('revealed');\n            cell.element.style.backgroundColor = '#e74c3c88';\n          }\n        }\n      }\n    }\n\n    function showMessage(text, type) {\n      messageElement.textContent = text;\n      messageElement.className = 'show ' + type;\n      messageElement.style.display = 'block';\n    }\n\n    function checkWin() {\n      if (gameOver) return;\n      // Win if all non-mine cells revealed\n      const totalCells = GRID_SIZE * GRID_SIZE;\n      if (revealed.size === totalCells - MINE_COUNT) {\n        endGame(true);\n      }\n    }\n\n    function onCellClick(e) {\n      if (gameOver) return;\n      const target = e.currentTarget;\n      const row = parseInt(target.getAttribute('data-row'));\n      const col = parseInt(target.getAttribute('data-col'));\n      if (e.button === 0) { // left click\n        if (firstClick) {\n          placeMines(row, col);\n          calculateAdjacentMines();\n          firstClick = false;\n          startTimer();\n        }\n        revealCell(row, col);\n      }\n    }\n\n    function onCellContextMenu(e) {\n      e.preventDefault();\n      if (gameOver) return;\n      const target = e.currentTarget;\n      const row = parseInt(target.getAttribute('data-row'));\n      const col = parseInt(target.getAttribute('data-col'));\n      if (firstClick) return; // no flags before first reveal\n      toggleFlag(row, col);\n    }\n\n    function onCellKeyDown(e) {\n      if (gameOver) return;\n      const target = e.currentTarget;\n      const row = parseInt(target.getAttribute('data-row'));\n      const col = parseInt(target.getAttribute('data-col'));\n      if (e.key === 'Enter' || e.key === ' ') {\n        e.preventDefault();\n        if (firstClick) {\n          placeMines(row, col);\n          calculateAdjacentMines();\n          firstClick = false;\n          startTimer();\n        }\n        revealCell(row, col);\n      } else if (e.key.toLowerCase() === 'f') {\n        e.preventDefault();\n        if (firstClick) return;\n        toggleFlag(row, col);\n      }\n    }\n\n    function addCellListeners(cell) {\n      cell.element.addEventListener('click', onCellClick);\n      cell.element.addEventListener('contextmenu', onCellContextMenu);\n      cell.element.addEventListener('keydown', onCellKeyDown);\n    }\n\n    function init() {\n      createGrid();\n      for (let i = 0; i < GRID_SIZE; i++) {\n        for (let j = 0; j < GRID_SIZE; j++) {\n          addCellListeners(grid[i][j]);\n        }\n      }\n      updateMineCount();\n      updateTimer();\n    }\n\n    newGameButton.addEventListener('click', () => {\n      init();\n    });\n\n    init();\n  </script>\n</body>\n</html>",
      "samples": 1,
      "inputTokens": 4403,
      "outputTokens": 3890,
      "timeMs": 47561
    },
    {
      "step": 10,
      "action": "Add these JavaScript functions for grid creation:\n...",
      "code": "<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\" />\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\"/>\n  <title>Minesweeper</title>\n  <style>\n    * {\n      margin: 0;\n      padding: 0;\n      box-sizing: border-box;\n    }\n    body {\n      display: flex;\n      justify-content: center;\n      align-items: center;\n      background: #1a1a2e;\n      min-height: 100vh;\n      font-family: system-ui;\n    }\n    .container {\n      display: flex;\n      flex-direction: column;\n      align-items: center;\n      padding: 20px;\n      width: 100%;\n      max-width: 600px;\n    }\n    .header {\n      text-align: center;\n      margin-bottom: 20px;\n      color: white;\n      user-select: none;\n    }\n    h1 {\n      font-size: 2.5rem;\n      margin-bottom: 10px;\n      text-shadow: 0 0 10px cyan;\n    }\n    .stats {\n      display: flex;\n      gap: 30px;\n      font-size: 1.2rem;\n      justify-content: center;\n      margin-bottom: 10px;\n    }\n    .stat {\n      display: flex;\n      align-items: center;\n      gap: 8px;\n      color: white;\n    }\n    .stat-icon {\n      font-size: 1.3rem;\n      user-select: none;\n    }\n    .stat-value {\n      font-weight: bold;\n      min-width: 40px;\n      text-align: center;\n      font-family: monospace;\n    }\n    .grid {\n      display: grid;\n      grid-template-columns: repeat(16, 1fr);\n      gap: 2px;\n      background: #0f0f1a;\n      padding: 10px;\n      border-radius: 8px;\n      box-shadow: 0 0 20px rgba(0,255,255,0.1);\n      user-select: none;\n      width: 100%;\n      max-width: 448px;\n    }\n    .cell {\n      width: 28px;\n      height: 28px;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      font-weight: bold;\n      cursor: pointer;\n      border-radius: 4px;\n      transition: all 0.15s;\n      user-select: none;\n      font-family: monospace;\n      font-size: 16px;\n      line-height: 1;\n    }\n    .cell.hidden {\n      background: linear-gradient(145deg, #3a3a5c, #2a2a4c);\n    }\n    .cell.hidden:hover {\n      background: #4a4a6c;\n      transform: scale(1.05);\n    }\n    .cell.revealed {\n      background: #1a1a2e;\n      cursor: default;\n      box-shadow: inset 0 0 5px #00000088;\n      color: inherit;\n    }\n    .cell.flagged {\n      background: #4a3a5c;\n      color: #f1c40f;\n      cursor: pointer;\n      text-shadow: 0 0 3px #f1c40f;\n    }\n    .cell.mine {\n      background: #ff4757;\n      color: white;\n      cursor: default;\n      box-shadow: inset 0 0 5px #b03a47;\n    }\n    .n1 { color: #3498db; }\n    .n2 { color: #2ecc71; }\n    .n3 { color: #e74c3c; }\n    .n4 { color: #9b59b6; }\n    .n5 { color: #e67e22; }\n    .n6 { color: #1abc9c; }\n    .n7 { color: #34495e; }\n    .n8 { color: #7f8c8d; }\n\n    .controls {\n      margin-top: 20px;\n      display: flex;\n      gap: 15px;\n      justify-content: center;\n      width: 100%;\n      max-width: 448px;\n    }\n    button {\n      padding: 12px 24px;\n      font-size: 1rem;\n      border: none;\n      border-radius: 6px;\n      cursor: pointer;\n      background: #4a4a7c;\n      color: white;\n      transition: all 0.2s;\n      user-select: none;\n      flex: 1;\n    }\n    button:hover {\n      background: #5a5a9c;\n      transform: translateY(-2px);\n    }\n    #message {\n      position: fixed;\n      top: 50%;\n      left: 50%;\n      transform: translate(-50%, -50%);\n      padding: 30px 50px;\n      border-radius: 12px;\n      font-size: 2rem;\n      font-weight: bold;\n      z-index: 100;\n      display: none;\n      user-select: none;\n      text-align: center;\n      box-shadow: 0 0 20px rgba(0,0,0,0.5);\n      max-width: 90vw;\n      word-break: break-word;\n    }\n    #message.show {\n      display: block;\n      animation: fadeIn 0.3s;\n    }\n    #message.win {\n      background: #2ed573;\n      color: white;\n    }\n    #message.lose {\n      background: #ff4757;\n      color: white;\n    }\n    @keyframes fadeIn {\n      from {\n        opacity: 0;\n        transform: translate(-50%, -50%) scale(0.8);\n      }\n      to {\n        opacity: 1;\n        transform: translate(-50%, -50%) scale(1);\n      }\n    }\n  </style>\n</head>\n<body>\n  <div class=\"container\">\n    <div class=\"header\">\n      <h1>Minesweeper</h1>\n      <div class=\"stats\">\n        <div class=\"stat\"><span class=\"stat-icon\">üí£</span><span id=\"mine-count\" class=\"stat-value\">40</span></div>\n        <div class=\"stat\"><span class=\"stat-icon\">‚è±Ô∏è</span><span id=\"timer\" class=\"stat-value\">00:00</span></div>\n      </div>\n    </div>\n    <div id=\"grid\" class=\"grid\"></div>\n    <div class=\"controls\">\n      <button id=\"new-game\">New Game</button>\n    </div>\n    <div id=\"message\"></div>\n  </div>\n  <script>\n    const GRID_SIZE = 16;\n    const MINE_COUNT = 40;\n    let grid = [];\n    let revealed = new Set();\n    let flagged = new Set();\n    let gameOver = false;\n    let gameWon = false;\n    let minesRemaining = MINE_COUNT;\n    let timerInterval = null;\n    let secondsElapsed = 0;\n    let firstClick = true;\n\n    const gridElement = document.getElementById('grid');\n    const mineCountElement = document.getElementById('mine-count');\n    const timerElement = document.getElementById('timer');\n    const messageElement = document.getElementById('message');\n    const newGameButton = document.getElementById('new-game');\n\n    function getNeighbors(row, col) {\n      const neighbors = [];\n      for (let dr = -1; dr <= 1; dr++) {\n        for (let dc = -1; dc <= 1; dc++) {\n          if (dr === 0 && dc === 0) continue;\n          const nr = row + dr, nc = col + dc;\n          if (nr >= 0 && nr < GRID_SIZE && nc >= 0 && nc < GRID_SIZE) {\n            neighbors.push([nr, nc]);\n          }\n        }\n      }\n      return neighbors;\n    }\n\n    function createGrid() {\n      grid = [];\n      for (let r = 0; r < GRID_SIZE; r++) {\n        grid[r] = [];\n        for (let c = 0; c < GRID_SIZE; c++) {\n          grid[r][c] = 0;\n        }\n      }\n      revealed.clear();\n      flagged.clear();\n      gameOver = false;\n      gameWon = false;\n      minesRemaining = MINE_COUNT;\n      firstClick = true;\n      secondsElapsed = 0;\n      updateMineCount();\n      updateTimer();\n      stopTimer();\n      messageElement.className = '';\n      messageElement.textContent = '';\n      messageElement.style.display = 'none';\n\n      gridElement.innerHTML = '';\n      gridElement.style.gridTemplateColumns = `repeat(${GRID_SIZE}, 1fr)`;\n\n      for (let i = 0; i < GRID_SIZE; i++) {\n        for (let j = 0; j < GRID_SIZE; j++) {\n          const cellElement = document.createElement('div');\n          cellElement.classList.add('cell', 'hidden');\n          cellElement.setAttribute('data-row', i);\n          cellElement.setAttribute('data-col', j);\n          cellElement.setAttribute('role', 'button');\n          cellElement.setAttribute('tabindex', '0');\n          cellElement.setAttribute('aria-label', 'Hidden cell');\n          gridElement.appendChild(cellElement);\n        }\n      }\n    }\n\n    function placeMines(excludeRow, excludeCol) {\n      let placed = 0;\n      while (placed < MINE_COUNT) {\n        const r = Math.floor(Math.random() * GRID_SIZE);\n        const c = Math.floor(Math.random() * GRID_SIZE);\n        if (grid[r][c] !== -1 && !(r === excludeRow && c === excludeCol)) {\n          grid[r][c] = -1;\n          placed++;\n        }\n      }\n    }\n\n    function calculateNumbers() {\n      for (let r = 0; r < GRID_SIZE; r++) {\n        for (let c = 0; c < GRID_SIZE; c++) {\n          if (grid[r][c] === -1) continue;\n          let count = 0;\n          for (const [nr, nc] of getNeighbors(r, c)) {\n            if (grid[nr][nc] === -1) count++;\n          }\n          grid[r][c] = count;\n        }\n      }\n    }\n\n    function getCellElement(row, col) {\n      return document.querySelector(`.cell[data-row=\"${row}\"][data-col=\"${col}\"]`);\n    }\n\n    function revealCell(row, col) {\n      if (gameOver) return;\n      const cellKey = `${row},${col}`;\n      if (revealed.has(cellKey) || flagged.has(cellKey)) return;\n      const cellValue = grid[row][col];\n      const cellElement = getCellElement(row, col);\n      revealed.add(cellKey);\n      cellElement.classList.remove('hidden', 'flagged');\n      cellElement.classList.add('revealed');\n      cellElement.setAttribute('aria-label', cellValue === -1 ? 'Mine' : `Revealed cell with ${cellValue} adjacent mines`);\n      if (cellValue === -1) {\n        cellElement.classList.add('mine');\n        cellElement.textContent = 'üí£';\n        endGame(false);\n        return;\n      }\n      if (cellValue > 0) {\n        cellElement.textContent = cellValue;\n        cellElement.classList.add('n' + cellValue);\n      } else {\n        cellElement.textContent = '';\n        // Reveal neighbors recursively\n        for (const [nr, nc] of getNeighbors(row, col)) {\n          if (!revealed.has(`${nr},${nc}`) && !flagged.has(`${nr},${nc}`)) {\n            revealCell(nr, nc);\n          }\n        }\n      }\n      checkWin();\n    }\n\n    function toggleFlag(row, col) {\n      if (gameOver) return;\n      const cellKey = `${row},${col}`;\n      if (revealed.has(cellKey)) return;\n      const cellElement = getCellElement(row, col);\n      if (flagged.has(cellKey)) {\n        flagged.delete(cellKey);\n        cellElement.classList.remove('flagged');\n        cellElement.classList.add('hidden');\n        cellElement.textContent = '';\n        minesRemaining++;\n      } else {\n        if (minesRemaining === 0) return;\n        flagged.add(cellKey);\n        cellElement.classList.remove('hidden');\n        cellElement.classList.add('flagged');\n        cellElement.textContent = 'üö©';\n        minesRemaining--;\n      }\n      updateMineCount();\n      checkWin();\n    }\n\n    function endGame(won) {\n      gameOver = true;\n      gameWon = won;\n      stopTimer();\n      revealAllMines();\n      showMessage(won ? 'You Win! üéâ' : 'Game Over üí•', won ? 'win' : 'lose');\n    }\n\n    function revealAllMines() {\n      for (let r = 0; r < GRID_SIZE; r++) {\n        for (let c = 0; c < GRID_SIZE; c++) {\n          const cellKey = `${r},${c}`;\n          const cellElement = getCellElement(r, c);\n          if (grid[r][c] === -1 && !revealed.has(cellKey)) {\n            cellElement.classList.remove('hidden', 'flagged');\n            cellElement.classList.add('revealed', 'mine');\n            cellElement.textContent = 'üí£';\n            revealed.add(cellKey);\n          }\n          if (grid[r][c] !== -1 && flagged.has(cellKey)) {\n            // Wrong flag\n            cellElement.classList.add('revealed');\n            cellElement.style.backgroundColor = '#e74c3c88';\n          }\n        }\n      }\n    }\n\n    function showMessage(text, type) {\n      messageElement.textContent = text;\n      messageElement.className = 'show ' + type;\n      messageElement.style.display = 'block';\n    }\n\n    function checkWin() {\n      if (gameOver) return;\n      const totalCells = GRID_SIZE * GRID_SIZE;\n      if (revealed.size === totalCells - MINE_COUNT) {\n        endGame(true);\n      }\n    }\n\n    function onCellClick(e) {\n      if (gameOver) return;\n      const target = e.currentTarget;\n      const row = parseInt(target.getAttribute('data-row'));\n      const col = parseInt(target.getAttribute('data-col'));\n      if (e.button === 0) {\n        if (firstClick) {\n          placeMines(row, col);\n          calculateNumbers();\n          firstClick = false;\n          startTimer();\n        }\n        revealCell(row, col);\n      }\n    }\n\n    function onCellContextMenu(e) {\n      e.preventDefault();\n      if (gameOver) return;\n      const target = e.currentTarget;\n      const row = parseInt(target.getAttribute('data-row'));\n      const col = parseInt(target.getAttribute('data-col'));\n      if (firstClick) return;\n      toggleFlag(row, col);\n    }\n\n    function onCellKeyDown(e) {\n      if (gameOver) return;\n      const target = e.currentTarget;\n      const row = parseInt(target.getAttribute('data-row'));\n      const col = parseInt(target.getAttribute('data-col'));\n      if (e.key === 'Enter' || e.key === ' ') {\n        e.preventDefault();\n        if (firstClick) {\n          placeMines(row, col);\n          calculateNumbers();\n          firstClick = false;\n          startTimer();\n        }\n        revealCell(row, col);\n      } else if (e.key.toLowerCase() === 'f') {\n        e.preventDefault();\n        if (firstClick) return;\n        toggleFlag(row, col);\n      }\n    }\n\n    function addCellListeners() {\n      const cells = document.querySelectorAll('.cell');\n      cells.forEach(cell => {\n        cell.addEventListener('click', onCellClick);\n        cell.addEventListener('contextmenu', onCellContextMenu);\n        cell.addEventListener('keydown', onCellKeyDown);\n      });\n    }\n\n    function updateMineCount() {\n      mineCountElement.textContent = minesRemaining;\n    }\n\n    function formatTime(secs) {\n      const m = Math.floor(secs / 60).toString().padStart(2, '0');\n      const s = (secs % 60).toString().padStart(2, '0');\n      return m + ':' + s;\n    }\n\n    function updateTimer() {\n      timerElement.textContent = formatTime(secondsElapsed);\n    }\n\n    function startTimer() {\n      if (timerInterval) return;\n      timerInterval = setInterval(() => { secondsElapsed++; updateTimer(); }, 1000);\n    }\n\n    function stopTimer() {\n      if (timerInterval) { clearInterval(timerInterval); timerInterval = null; }\n    }\n\n    function init() {\n      createGrid();\n      gridElement.innerHTML = '';\n      for (let i = 0; i < GRID_SIZE; i++) {\n        for (let j = 0; j < GRID_SIZE; j++) {\n          const cellElement = document.createElement('div');\n          cellElement.classList.add('cell', 'hidden');\n          cellElement.setAttribute('data-row', i);\n          cellElement.setAttribute('data-col', j);\n          cellElement.setAttribute('role', 'button');\n          cellElement.setAttribute('tabindex', '0');\n          cellElement.setAttribute('aria-label', 'Hidden cell');\n          gridElement.appendChild(cellElement);\n        }\n      }\n      addCellListeners();\n      updateMineCount();\n      updateTimer();\n    }\n\n    newGameButton.addEventListener('click', () => {\n      init();\n    });\n\n    init();\n  </script>\n</body>\n</html>",
      "samples": 1,
      "inputTokens": 4535,
      "outputTokens": 3793,
      "timeMs": 46121
    },
    {
      "step": 11,
      "action": "Add the renderGrid function:\nfunction renderGrid()...",
      "code": "<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\" />\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\"/>\n  <title>Minesweeper</title>\n  <style>\n    * {\n      margin: 0;\n      padding: 0;\n      box-sizing: border-box;\n    }\n    body {\n      display: flex;\n      justify-content: center;\n      align-items: center;\n      background: #1a1a2e;\n      min-height: 100vh;\n      font-family: system-ui;\n    }\n    .container {\n      display: flex;\n      flex-direction: column;\n      align-items: center;\n      padding: 20px;\n      width: 100%;\n      max-width: 600px;\n    }\n    .header {\n      text-align: center;\n      margin-bottom: 20px;\n      color: white;\n      user-select: none;\n    }\n    h1 {\n      font-size: 2.5rem;\n      margin-bottom: 10px;\n      text-shadow: 0 0 10px cyan;\n    }\n    .stats {\n      display: flex;\n      gap: 30px;\n      font-size: 1.2rem;\n      justify-content: center;\n      margin-bottom: 10px;\n    }\n    .stat {\n      display: flex;\n      align-items: center;\n      gap: 8px;\n      color: white;\n    }\n    .stat-icon {\n      font-size: 1.3rem;\n      user-select: none;\n    }\n    .stat-value {\n      font-weight: bold;\n      min-width: 40px;\n      text-align: center;\n      font-family: monospace;\n    }\n    .grid {\n      display: grid;\n      grid-template-columns: repeat(16, 1fr);\n      gap: 2px;\n      background: #0f0f1a;\n      padding: 10px;\n      border-radius: 8px;\n      box-shadow: 0 0 20px rgba(0,255,255,0.1);\n      user-select: none;\n      width: 100%;\n      max-width: 448px;\n    }\n    .cell {\n      width: 28px;\n      height: 28px;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      font-weight: bold;\n      cursor: pointer;\n      border-radius: 4px;\n      transition: all 0.15s;\n      user-select: none;\n      font-family: monospace;\n      font-size: 16px;\n      line-height: 1;\n    }\n    .cell.hidden {\n      background: linear-gradient(145deg, #3a3a5c, #2a2a4c);\n    }\n    .cell.hidden:hover {\n      background: #4a4a6c;\n      transform: scale(1.05);\n    }\n    .cell.revealed {\n      background: #1a1a2e;\n      cursor: default;\n      box-shadow: inset 0 0 5px #00000088;\n      color: inherit;\n    }\n    .cell.flagged {\n      background: #4a3a5c;\n      color: #f1c40f;\n      cursor: pointer;\n      text-shadow: 0 0 3px #f1c40f;\n    }\n    .cell.mine {\n      background: #ff4757;\n      color: white;\n      cursor: default;\n      box-shadow: inset 0 0 5px #b03a47;\n    }\n    .n1 { color: #3498db; }\n    .n2 { color: #2ecc71; }\n    .n3 { color: #e74c3c; }\n    .n4 { color: #9b59b6; }\n    .n5 { color: #e67e22; }\n    .n6 { color: #1abc9c; }\n    .n7 { color: #34495e; }\n    .n8 { color: #7f8c8d; }\n\n    .controls {\n      margin-top: 20px;\n      display: flex;\n      gap: 15px;\n      justify-content: center;\n      width: 100%;\n      max-width: 448px;\n    }\n    button {\n      padding: 12px 24px;\n      font-size: 1rem;\n      border: none;\n      border-radius: 6px;\n      cursor: pointer;\n      background: #4a4a7c;\n      color: white;\n      transition: all 0.2s;\n      user-select: none;\n      flex: 1;\n    }\n    button:hover {\n      background: #5a5a9c;\n      transform: translateY(-2px);\n    }\n    #message {\n      position: fixed;\n      top: 50%;\n      left: 50%;\n      transform: translate(-50%, -50%);\n      padding: 30px 50px;\n      border-radius: 12px;\n      font-size: 2rem;\n      font-weight: bold;\n      z-index: 100;\n      display: none;\n      user-select: none;\n      text-align: center;\n      box-shadow: 0 0 20px rgba(0,0,0,0.5);\n      max-width: 90vw;\n      word-break: break-word;\n    }\n    #message.show {\n      display: block;\n      animation: fadeIn 0.3s;\n    }\n    #message.win {\n      background: #2ed573;\n      color: white;\n    }\n    #message.lose {\n      background: #ff4757;\n      color: white;\n    }\n    @keyframes fadeIn {\n      from {\n        opacity: 0;\n        transform: translate(-50%, -50%) scale(0.8);\n      }\n      to {\n        opacity: 1;\n        transform: translate(-50%, -50%) scale(1);\n      }\n    }\n  </style>\n</head>\n<body>\n  <div class=\"container\">\n    <div class=\"header\">\n      <h1>Minesweeper</h1>\n      <div class=\"stats\">\n        <div class=\"stat\"><span class=\"stat-icon\">üí£</span><span id=\"mine-count\" class=\"stat-value\">40</span></div>\n        <div class=\"stat\"><span class=\"stat-icon\">‚è±Ô∏è</span><span id=\"timer\" class=\"stat-value\">00:00</span></div>\n      </div>\n    </div>\n    <div id=\"grid\" class=\"grid\"></div>\n    <div class=\"controls\">\n      <button id=\"new-game\">New Game</button>\n    </div>\n    <div id=\"message\"></div>\n  </div>\n  <script>\n    const GRID_SIZE = 16;\n    const MINE_COUNT = 40;\n    let grid = [];\n    let revealed = new Set();\n    let flagged = new Set();\n    let gameOver = false;\n    let gameWon = false;\n    let minesRemaining = MINE_COUNT;\n    let timerInterval = null;\n    let secondsElapsed = 0;\n    let firstClick = true;\n\n    const gridElement = document.getElementById('grid');\n    const mineCountElement = document.getElementById('mine-count');\n    const timerElement = document.getElementById('timer');\n    const messageElement = document.getElementById('message');\n    const newGameButton = document.getElementById('new-game');\n\n    function getNeighbors(row, col) {\n      const neighbors = [];\n      for (let dr = -1; dr <= 1; dr++) {\n        for (let dc = -1; dc <= 1; dc++) {\n          if (dr === 0 && dc === 0) continue;\n          const nr = row + dr, nc = col + dc;\n          if (nr >= 0 && nr < GRID_SIZE && nc >= 0 && nc < GRID_SIZE) {\n            neighbors.push([nr, nc]);\n          }\n        }\n      }\n      return neighbors;\n    }\n\n    function createGrid() {\n      grid = [];\n      for (let r = 0; r < GRID_SIZE; r++) {\n        grid[r] = [];\n        for (let c = 0; c < GRID_SIZE; c++) {\n          grid[r][c] = 0;\n        }\n      }\n      revealed.clear();\n      flagged.clear();\n      gameOver = false;\n      gameWon = false;\n      minesRemaining = MINE_COUNT;\n      firstClick = true;\n      secondsElapsed = 0;\n      updateMineCount();\n      updateTimer();\n      stopTimer();\n      messageElement.className = '';\n      messageElement.textContent = '';\n      messageElement.style.display = 'none';\n    }\n\n    function placeMines(excludeRow, excludeCol) {\n      let placed = 0;\n      while (placed < MINE_COUNT) {\n        const r = Math.floor(Math.random() * GRID_SIZE);\n        const c = Math.floor(Math.random() * GRID_SIZE);\n        if (grid[r][c] !== -1 && !(r === excludeRow && c === excludeCol)) {\n          grid[r][c] = -1;\n          placed++;\n        }\n      }\n    }\n\n    function calculateNumbers() {\n      for (let r = 0; r < GRID_SIZE; r++) {\n        for (let c = 0; c < GRID_SIZE; c++) {\n          if (grid[r][c] === -1) continue;\n          let count = 0;\n          for (const [nr, nc] of getNeighbors(r, c)) {\n            if (grid[nr][nc] === -1) count++;\n          }\n          grid[r][c] = count;\n        }\n      }\n    }\n\n    function getCellElement(row, col) {\n      return document.querySelector(`.cell[data-row=\"${row}\"][data-col=\"${col}\"]`);\n    }\n\n    function revealCell(row, col) {\n      if (gameOver) return;\n      const cellKey = `${row},${col}`;\n      if (revealed.has(cellKey) || flagged.has(cellKey)) return;\n      const cellValue = grid[row][col];\n      const cellElement = getCellElement(row, col);\n      revealed.add(cellKey);\n      cellElement.classList.remove('hidden', 'flagged');\n      cellElement.classList.add('revealed');\n      cellElement.setAttribute('aria-label', cellValue === -1 ? 'Mine' : `Revealed cell with ${cellValue} adjacent mines`);\n      if (cellValue === -1) {\n        cellElement.classList.add('mine');\n        cellElement.textContent = 'üí£';\n        endGame(false);\n        return;\n      }\n      if (cellValue > 0) {\n        cellElement.textContent = cellValue;\n        cellElement.classList.add('n' + cellValue);\n      } else {\n        cellElement.textContent = '';\n        // Reveal neighbors recursively\n        for (const [nr, nc] of getNeighbors(row, col)) {\n          if (!revealed.has(`${nr},${nc}`) && !flagged.has(`${nr},${nc}`)) {\n            revealCell(nr, nc);\n          }\n        }\n      }\n      checkWin();\n    }\n\n    function toggleFlag(row, col) {\n      if (gameOver) return;\n      const cellKey = `${row},${col}`;\n      if (revealed.has(cellKey)) return;\n      const cellElement = getCellElement(row, col);\n      if (flagged.has(cellKey)) {\n        flagged.delete(cellKey);\n        cellElement.classList.remove('flagged');\n        cellElement.classList.add('hidden');\n        cellElement.textContent = '';\n        minesRemaining++;\n      } else {\n        if (minesRemaining === 0) return;\n        flagged.add(cellKey);\n        cellElement.classList.remove('hidden');\n        cellElement.classList.add('flagged');\n        cellElement.textContent = 'üö©';\n        minesRemaining--;\n      }\n      updateMineCount();\n      checkWin();\n    }\n\n    function endGame(won) {\n      gameOver = true;\n      gameWon = won;\n      stopTimer();\n      revealAllMines();\n      showMessage(won ? 'You Win! üéâ' : 'Game Over üí•', won ? 'win' : 'lose');\n    }\n\n    function revealAllMines() {\n      for (let r = 0; r < GRID_SIZE; r++) {\n        for (let c = 0; c < GRID_SIZE; c++) {\n          const cellKey = `${r},${c}`;\n          const cellElement = getCellElement(r, c);\n          if (grid[r][c] === -1 && !revealed.has(cellKey)) {\n            cellElement.classList.remove('hidden', 'flagged');\n            cellElement.classList.add('revealed', 'mine');\n            cellElement.textContent = 'üí£';\n            revealed.add(cellKey);\n          }\n          if (grid[r][c] !== -1 && flagged.has(cellKey)) {\n            // Wrong flag\n            cellElement.classList.add('revealed');\n            cellElement.style.backgroundColor = '#e74c3c88';\n          }\n        }\n      }\n    }\n\n    function showMessage(text, type) {\n      messageElement.textContent = text;\n      messageElement.className = 'show ' + type;\n      messageElement.style.display = 'block';\n    }\n\n    function checkWin() {\n      if (gameOver) return;\n      const totalCells = GRID_SIZE * GRID_SIZE;\n      if (revealed.size === totalCells - MINE_COUNT) {\n        endGame(true);\n      }\n    }\n\n    function handleClick(row, col) {\n      if (gameOver) return;\n      if (firstClick) {\n        placeMines(row, col);\n        calculateNumbers();\n        firstClick = false;\n        startTimer();\n      }\n      revealCell(row, col);\n    }\n\n    function handleRightClick(row, col, e) {\n      e.preventDefault();\n      if (gameOver) return;\n      if (firstClick) return;\n      toggleFlag(row, col);\n    }\n\n    function renderGrid() {\n      const gridEl = document.getElementById('grid');\n      gridEl.innerHTML = '';\n      for (let r = 0; r < GRID_SIZE; r++) {\n        for (let c = 0; c < GRID_SIZE; c++) {\n          const cell = document.createElement('div');\n          cell.className = 'cell hidden';\n          cell.dataset.row = r;\n          cell.dataset.col = c;\n          cell.setAttribute('role', 'button');\n          cell.setAttribute('tabindex', '0');\n          cell.setAttribute('aria-label', 'Hidden cell');\n          cell.addEventListener('click', () => handleClick(r, c));\n          cell.addEventListener('contextmenu', (e) => handleRightClick(r, c, e));\n          cell.addEventListener('keydown', (e) => {\n            if (gameOver) return;\n            if (e.key === 'Enter' || e.key === ' ') {\n              e.preventDefault();\n              handleClick(r, c);\n            } else if (e.key.toLowerCase() === 'f') {\n              e.preventDefault();\n              if (firstClick) return;\n              toggleFlag(r, c);\n            }\n          });\n          gridEl.appendChild(cell);\n        }\n      }\n    }\n\n    function updateMineCount() {\n      mineCountElement.textContent = minesRemaining;\n    }\n\n    function formatTime(secs) {\n      const m = Math.floor(secs / 60).toString().padStart(2, '0');\n      const s = (secs % 60).toString().padStart(2, '0');\n      return m + ':' + s;\n    }\n\n    function updateTimer() {\n      timerElement.textContent = formatTime(secondsElapsed);\n    }\n\n    function startTimer() {\n      if (timerInterval) return;\n      timerInterval = setInterval(() => { secondsElapsed++; updateTimer(); }, 1000);\n    }\n\n    function stopTimer() {\n      if (timerInterval) { clearInterval(timerInterval); timerInterval = null; }\n    }\n\n    function init() {\n      createGrid();\n      renderGrid();\n      updateMineCount();\n      updateTimer();\n    }\n\n    newGameButton.addEventListener('click', () => {\n      init();\n    });\n\n    init();\n  </script>\n</body>\n</html>",
      "samples": 1,
      "inputTokens": 4308,
      "outputTokens": 3477,
      "timeMs": 40780
    },
    {
      "step": 12,
      "action": "Add the click handler functions:\nfunction handleCl...",
      "code": "<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\" />\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\"/>\n  <title>Minesweeper</title>\n  <style>\n    * {\n      margin: 0;\n      padding: 0;\n      box-sizing: border-box;\n    }\n    body {\n      display: flex;\n      justify-content: center;\n      align-items: center;\n      background: #1a1a2e;\n      min-height: 100vh;\n      font-family: system-ui;\n    }\n    .container {\n      display: flex;\n      flex-direction: column;\n      align-items: center;\n      padding: 20px;\n      width: 100%;\n      max-width: 600px;\n    }\n    .header {\n      text-align: center;\n      margin-bottom: 20px;\n      color: white;\n      user-select: none;\n    }\n    h1 {\n      font-size: 2.5rem;\n      margin-bottom: 10px;\n      text-shadow: 0 0 10px cyan;\n    }\n    .stats {\n      display: flex;\n      gap: 30px;\n      font-size: 1.2rem;\n      justify-content: center;\n      margin-bottom: 10px;\n    }\n    .stat {\n      display: flex;\n      align-items: center;\n      gap: 8px;\n      color: white;\n    }\n    .stat-icon {\n      font-size: 1.3rem;\n      user-select: none;\n    }\n    .stat-value {\n      font-weight: bold;\n      min-width: 40px;\n      text-align: center;\n      font-family: monospace;\n    }\n    .grid {\n      display: grid;\n      grid-template-columns: repeat(16, 1fr);\n      gap: 2px;\n      background: #0f0f1a;\n      padding: 10px;\n      border-radius: 8px;\n      box-shadow: 0 0 20px rgba(0,255,255,0.1);\n      user-select: none;\n      width: 100%;\n      max-width: 448px;\n    }\n    .cell {\n      width: 28px;\n      height: 28px;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      font-weight: bold;\n      cursor: pointer;\n      border-radius: 4px;\n      transition: all 0.15s;\n      user-select: none;\n      font-family: monospace;\n      font-size: 16px;\n      line-height: 1;\n    }\n    .cell.hidden {\n      background: linear-gradient(145deg, #3a3a5c, #2a2a4c);\n    }\n    .cell.hidden:hover {\n      background: #4a4a6c;\n      transform: scale(1.05);\n    }\n    .cell.revealed {\n      background: #1a1a2e;\n      cursor: default;\n      box-shadow: inset 0 0 5px #00000088;\n      color: inherit;\n    }\n    .cell.flagged {\n      background: #4a3a5c;\n      color: #f1c40f;\n      cursor: pointer;\n      text-shadow: 0 0 3px #f1c40f;\n    }\n    .cell.mine {\n      background: #ff4757;\n      color: white;\n      cursor: default;\n      box-shadow: inset 0 0 5px #b03a47;\n    }\n    .n1 { color: #3498db; }\n    .n2 { color: #2ecc71; }\n    .n3 { color: #e74c3c; }\n    .n4 { color: #9b59b6; }\n    .n5 { color: #e67e22; }\n    .n6 { color: #1abc9c; }\n    .n7 { color: #34495e; }\n    .n8 { color: #7f8c8d; }\n\n    .controls {\n      margin-top: 20px;\n      display: flex;\n      gap: 15px;\n      justify-content: center;\n      width: 100%;\n      max-width: 448px;\n    }\n    button {\n      padding: 12px 24px;\n      font-size: 1rem;\n      border: none;\n      border-radius: 6px;\n      cursor: pointer;\n      background: #4a4a7c;\n      color: white;\n      transition: all 0.2s;\n      user-select: none;\n      flex: 1;\n    }\n    button:hover {\n      background: #5a5a9c;\n      transform: translateY(-2px);\n    }\n    #message {\n      position: fixed;\n      top: 50%;\n      left: 50%;\n      transform: translate(-50%, -50%);\n      padding: 30px 50px;\n      border-radius: 12px;\n      font-size: 2rem;\n      font-weight: bold;\n      z-index: 100;\n      display: none;\n      user-select: none;\n      text-align: center;\n      box-shadow: 0 0 20px rgba(0,0,0,0.5);\n      max-width: 90vw;\n      word-break: break-word;\n    }\n    #message.show {\n      display: block;\n      animation: fadeIn 0.3s;\n    }\n    #message.win {\n      background: #2ed573;\n      color: white;\n    }\n    #message.lose {\n      background: #ff4757;\n      color: white;\n    }\n    @keyframes fadeIn {\n      from {\n        opacity: 0;\n        transform: translate(-50%, -50%) scale(0.8);\n      }\n      to {\n        opacity: 1;\n        transform: translate(-50%, -50%) scale(1);\n      }\n    }\n  </style>\n</head>\n<body>\n  <div class=\"container\">\n    <div class=\"header\">\n      <h1>Minesweeper</h1>\n      <div class=\"stats\">\n        <div class=\"stat\"><span class=\"stat-icon\">üí£</span><span id=\"mine-count\" class=\"stat-value\">40</span></div>\n        <div class=\"stat\"><span class=\"stat-icon\">‚è±Ô∏è</span><span id=\"timer\" class=\"stat-value\">00:00</span></div>\n      </div>\n    </div>\n    <div id=\"grid\" class=\"grid\"></div>\n    <div class=\"controls\">\n      <button id=\"new-game\">New Game</button>\n    </div>\n    <div id=\"message\"></div>\n  </div>\n  <script>\n    const GRID_SIZE = 16;\n    const MINE_COUNT = 40;\n    let grid = [];\n    let revealed = new Set();\n    let flagged = new Set();\n    let gameOver = false;\n    let gameWon = false;\n    let minesRemaining = MINE_COUNT;\n    let timerInterval = null;\n    let secondsElapsed = 0;\n    let firstClick = true;\n\n    const gridElement = document.getElementById('grid');\n    const mineCountElement = document.getElementById('mine-count');\n    const timerElement = document.getElementById('timer');\n    const messageElement = document.getElementById('message');\n    const newGameButton = document.getElementById('new-game');\n\n    function getNeighbors(row, col) {\n      const neighbors = [];\n      for (let dr = -1; dr <= 1; dr++) {\n        for (let dc = -1; dc <= 1; dc++) {\n          if (dr === 0 && dc === 0) continue;\n          const nr = row + dr, nc = col + dc;\n          if (nr >= 0 && nr < GRID_SIZE && nc >= 0 && nc < GRID_SIZE) {\n            neighbors.push([nr, nc]);\n          }\n        }\n      }\n      return neighbors;\n    }\n\n    function createGrid() {\n      grid = [];\n      for (let r = 0; r < GRID_SIZE; r++) {\n        grid[r] = [];\n        for (let c = 0; c < GRID_SIZE; c++) {\n          grid[r][c] = 0;\n        }\n      }\n      revealed.clear();\n      flagged.clear();\n      gameOver = false;\n      gameWon = false;\n      minesRemaining = MINE_COUNT;\n      firstClick = true;\n      secondsElapsed = 0;\n      updateMineCount();\n      updateTimer();\n      stopTimer();\n      messageElement.className = '';\n      messageElement.textContent = '';\n      messageElement.style.display = 'none';\n    }\n\n    function placeMines(excludeRow, excludeCol) {\n      let placed = 0;\n      while (placed < MINE_COUNT) {\n        const r = Math.floor(Math.random() * GRID_SIZE);\n        const c = Math.floor(Math.random() * GRID_SIZE);\n        if (grid[r][c] !== -1 && !(r === excludeRow && c === excludeCol)) {\n          grid[r][c] = -1;\n          placed++;\n        }\n      }\n    }\n\n    function calculateNumbers() {\n      for (let r = 0; r < GRID_SIZE; r++) {\n        for (let c = 0; c < GRID_SIZE; c++) {\n          if (grid[r][c] === -1) continue;\n          let count = 0;\n          for (const [nr, nc] of getNeighbors(r, c)) {\n            if (grid[nr][nc] === -1) count++;\n          }\n          grid[r][c] = count;\n        }\n      }\n    }\n\n    function getCellElement(row, col) {\n      return document.querySelector(`.cell[data-row=\"${row}\"][data-col=\"${col}\"]`);\n    }\n\n    function getCell(row, col) {\n      return getCellElement(row, col);\n    }\n\n    function revealCell(row, col) {\n      if (gameOver) return;\n      const cellKey = `${row},${col}`;\n      if (revealed.has(cellKey) || flagged.has(cellKey)) return;\n      const cellValue = grid[row][col];\n      const cellElement = getCellElement(row, col);\n      revealed.add(cellKey);\n      cellElement.classList.remove('hidden', 'flagged');\n      cellElement.classList.add('revealed');\n      cellElement.setAttribute('aria-label', cellValue === -1 ? 'Mine' : `Revealed cell with ${cellValue} adjacent mines`);\n      if (cellValue === -1) {\n        cellElement.classList.add('mine');\n        cellElement.textContent = 'üí£';\n        endGame(false);\n        return;\n      }\n      if (cellValue > 0) {\n        cellElement.textContent = cellValue;\n        cellElement.classList.add('n' + cellValue);\n      } else {\n        cellElement.textContent = '';\n        // Reveal neighbors recursively\n        for (const [nr, nc] of getNeighbors(row, col)) {\n          if (!revealed.has(`${nr},${nc}`) && !flagged.has(`${nr},${nc}`)) {\n            revealCell(nr, nc);\n          }\n        }\n      }\n    }\n\n    function revealMine(row, col) {\n      const cellElement = getCellElement(row, col);\n      cellElement.classList.remove('hidden', 'flagged');\n      cellElement.classList.add('revealed', 'mine');\n      cellElement.textContent = 'üí£';\n      revealed.add(`${row},${col}`);\n    }\n\n    function toggleFlag(row, col) {\n      if (gameOver) return;\n      const cellKey = `${row},${col}`;\n      if (revealed.has(cellKey)) return;\n      const cellElement = getCellElement(row, col);\n      if (flagged.has(cellKey)) {\n        flagged.delete(cellKey);\n        cellElement.classList.remove('flagged');\n        cellElement.classList.add('hidden');\n        cellElement.textContent = '';\n        minesRemaining++;\n      } else {\n        if (minesRemaining === 0) return;\n        flagged.add(cellKey);\n        cellElement.classList.remove('hidden');\n        cellElement.classList.add('flagged');\n        cellElement.textContent = 'üö©';\n        minesRemaining--;\n      }\n      updateMineCount();\n    }\n\n    function endGame(won) {\n      gameOver = true;\n      gameWon = won;\n      stopTimer();\n      revealAllMines();\n      showMessage(won ? 'You Win! üéâ' : 'Game Over üí•', won ? 'win' : 'lose');\n    }\n\n    function revealAllMines() {\n      for (let r = 0; r < GRID_SIZE; r++) {\n        for (let c = 0; c < GRID_SIZE; c++) {\n          const cellKey = `${r},${c}`;\n          const cellElement = getCellElement(r, c);\n          if (grid[r][c] === -1 && !revealed.has(cellKey)) {\n            cellElement.classList.remove('hidden', 'flagged');\n            cellElement.classList.add('revealed', 'mine');\n            cellElement.textContent = 'üí£';\n            revealed.add(cellKey);\n          }\n          if (grid[r][c] !== -1 && flagged.has(cellKey)) {\n            // Wrong flag\n            cellElement.classList.add('revealed');\n            cellElement.style.backgroundColor = '#e74c3c88';\n          }\n        }\n      }\n    }\n\n    function showMessage(text, type) {\n      messageElement.textContent = text;\n      messageElement.className = 'show ' + type;\n      messageElement.style.display = 'block';\n    }\n\n    function checkWin() {\n      if (gameOver) return;\n      const totalCells = GRID_SIZE * GRID_SIZE;\n      if (revealed.size === totalCells - MINE_COUNT) {\n        endGame(true);\n      }\n    }\n\n    function handleClick(row, col) {\n      if (gameOver) return;\n      const key = row + ',' + col;\n      if (flagged.has(key) || revealed.has(key)) return;\n      \n      if (firstClick) {\n        firstClick = false;\n        placeMines(row, col);\n        calculateNumbers();\n        startTimer();\n      }\n      \n      if (grid[row][col] === -1) {\n        revealMine(row, col);\n        endGame(false);\n        return;\n      }\n      \n      revealCell(row, col);\n      checkWin();\n    }\n\n    function handleRightClick(row, col, e) {\n      e.preventDefault();\n      if (gameOver) return;\n      const key = row + ',' + col;\n      if (revealed.has(key)) return;\n      \n      const cell = getCell(row, col);\n      if (flagged.has(key)) {\n        flagged.delete(key);\n        cell.textContent = '';\n        cell.classList.remove('flagged');\n        minesRemaining++;\n      } else {\n        flagged.add(key);\n        cell.textContent = 'üö©';\n        cell.classList.add('flagged');\n        minesRemaining--;\n      }\n      updateMineCount();\n    }\n\n    function renderGrid() {\n      const gridEl = document.getElementById('grid');\n      gridEl.innerHTML = '';\n      for (let r = 0; r < GRID_SIZE; r++) {\n        for (let c = 0; c < GRID_SIZE; c++) {\n          const cell = document.createElement('div');\n          cell.className = 'cell hidden';\n          cell.dataset.row = r;\n          cell.dataset.col = c;\n          cell.setAttribute('role', 'button');\n          cell.setAttribute('tabindex', '0');\n          cell.setAttribute('aria-label', 'Hidden cell');\n          cell.addEventListener('click', () => handleClick(r, c));\n          cell.addEventListener('contextmenu', (e) => handleRightClick(r, c, e));\n          cell.addEventListener('keydown', (e) => {\n            if (gameOver) return;\n            if (e.key === 'Enter' || e.key === ' ') {\n              e.preventDefault();\n              handleClick(r, c);\n            } else if (e.key.toLowerCase() === 'f') {\n              e.preventDefault();\n              if (firstClick) return;\n              toggleFlag(r, c);\n            }\n          });\n          gridEl.appendChild(cell);\n        }\n      }\n    }\n\n    function updateMineCount() {\n      mineCountElement.textContent = minesRemaining;\n    }\n\n    function formatTime(secs) {\n      const m = Math.floor(secs / 60).toString().padStart(2, '0');\n      const s = (secs % 60).toString().padStart(2, '0');\n      return m + ':' + s;\n    }\n\n    function updateTimer() {\n      timerElement.textContent = formatTime(secondsElapsed);\n    }\n\n    function startTimer() {\n      if (timerInterval) return;\n      timerInterval = setInterval(() => { secondsElapsed++; updateTimer(); }, 1000);\n    }\n\n    function stopTimer() {\n      if (timerInterval) { clearInterval(timerInterval); timerInterval = null; }\n    }\n\n    function init() {\n      createGrid();\n      renderGrid();\n      updateMineCount();\n      updateTimer();\n    }\n\n    newGameButton.addEventListener('click', () => {\n      init();\n    });\n\n    init();\n  </script>\n</body>\n</html>",
      "samples": 1,
      "inputTokens": 4094,
      "outputTokens": 3706,
      "timeMs": 49841
    },
    {
      "step": 13,
      "action": "Add the reveal functions:\nfunction revealCell(row,...",
      "code": "<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\" />\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\"/>\n  <title>Minesweeper</title>\n  <style>\n    * {\n      margin: 0;\n      padding: 0;\n      box-sizing: border-box;\n    }\n    body {\n      display: flex;\n      justify-content: center;\n      align-items: center;\n      background: #1a1a2e;\n      min-height: 100vh;\n      font-family: system-ui;\n    }\n    .container {\n      display: flex;\n      flex-direction: column;\n      align-items: center;\n      padding: 20px;\n      width: 100%;\n      max-width: 600px;\n    }\n    .header {\n      text-align: center;\n      margin-bottom: 20px;\n      color: white;\n      user-select: none;\n    }\n    h1 {\n      font-size: 2.5rem;\n      margin-bottom: 10px;\n      text-shadow: 0 0 10px cyan;\n    }\n    .stats {\n      display: flex;\n      gap: 30px;\n      font-size: 1.2rem;\n      justify-content: center;\n      margin-bottom: 10px;\n    }\n    .stat {\n      display: flex;\n      align-items: center;\n      gap: 8px;\n      color: white;\n    }\n    .stat-icon {\n      font-size: 1.3rem;\n      user-select: none;\n    }\n    .stat-value {\n      font-weight: bold;\n      min-width: 40px;\n      text-align: center;\n      font-family: monospace;\n    }\n    .grid {\n      display: grid;\n      grid-template-columns: repeat(16, 1fr);\n      gap: 2px;\n      background: #0f0f1a;\n      padding: 10px;\n      border-radius: 8px;\n      box-shadow: 0 0 20px rgba(0,255,255,0.1);\n      user-select: none;\n      width: 100%;\n      max-width: 448px;\n    }\n    .cell {\n      width: 28px;\n      height: 28px;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      font-weight: bold;\n      cursor: pointer;\n      border-radius: 4px;\n      transition: all 0.15s;\n      user-select: none;\n      font-family: monospace;\n      font-size: 16px;\n      line-height: 1;\n    }\n    .cell.hidden {\n      background: linear-gradient(145deg, #3a3a5c, #2a2a4c);\n    }\n    .cell.hidden:hover {\n      background: #4a4a6c;\n      transform: scale(1.05);\n    }\n    .cell.revealed {\n      background: #1a1a2e;\n      cursor: default;\n      box-shadow: inset 0 0 5px #00000088;\n      color: inherit;\n    }\n    .cell.flagged {\n      background: #4a3a5c;\n      color: #f1c40f;\n      cursor: pointer;\n      text-shadow: 0 0 3px #f1c40f;\n    }\n    .cell.mine {\n      background: #ff4757;\n      color: white;\n      cursor: default;\n      box-shadow: inset 0 0 5px #b03a47;\n    }\n    .n1 { color: #3498db; }\n    .n2 { color: #2ecc71; }\n    .n3 { color: #e74c3c; }\n    .n4 { color: #9b59b6; }\n    .n5 { color: #e67e22; }\n    .n6 { color: #1abc9c; }\n    .n7 { color: #34495e; }\n    .n8 { color: #7f8c8d; }\n\n    .controls {\n      margin-top: 20px;\n      display: flex;\n      gap: 15px;\n      justify-content: center;\n      width: 100%;\n      max-width: 448px;\n    }\n    button {\n      padding: 12px 24px;\n      font-size: 1rem;\n      border: none;\n      border-radius: 6px;\n      cursor: pointer;\n      background: #4a4a7c;\n      color: white;\n      transition: all 0.2s;\n      user-select: none;\n      flex: 1;\n    }\n    button:hover {\n      background: #5a5a9c;\n      transform: translateY(-2px);\n    }\n    #message {\n      position: fixed;\n      top: 50%;\n      left: 50%;\n      transform: translate(-50%, -50%);\n      padding: 30px 50px;\n      border-radius: 12px;\n      font-size: 2rem;\n      font-weight: bold;\n      z-index: 100;\n      display: none;\n      user-select: none;\n      text-align: center;\n      box-shadow: 0 0 20px rgba(0,0,0,0.5);\n      max-width: 90vw;\n      word-break: break-word;\n    }\n    #message.show {\n      display: block;\n      animation: fadeIn 0.3s;\n    }\n    #message.win {\n      background: #2ed573;\n      color: white;\n    }\n    #message.lose {\n      background: #ff4757;\n      color: white;\n    }\n    @keyframes fadeIn {\n      from {\n        opacity: 0;\n        transform: translate(-50%, -50%) scale(0.8);\n      }\n      to {\n        opacity: 1;\n        transform: translate(-50%, -50%) scale(1);\n      }\n    }\n  </style>\n</head>\n<body>\n  <div class=\"container\">\n    <div class=\"header\">\n      <h1>Minesweeper</h1>\n      <div class=\"stats\">\n        <div class=\"stat\"><span class=\"stat-icon\">üí£</span><span id=\"mine-count\" class=\"stat-value\">40</span></div>\n        <div class=\"stat\"><span class=\"stat-icon\">‚è±Ô∏è</span><span id=\"timer\" class=\"stat-value\">00:00</span></div>\n      </div>\n    </div>\n    <div id=\"grid\" class=\"grid\"></div>\n    <div class=\"controls\">\n      <button id=\"new-game\">New Game</button>\n    </div>\n    <div id=\"message\"></div>\n  </div>\n  <script>\n    const GRID_SIZE = 16;\n    const MINE_COUNT = 40;\n    let grid = [];\n    let revealed = new Set();\n    let flagged = new Set();\n    let gameOver = false;\n    let gameWon = false;\n    let minesRemaining = MINE_COUNT;\n    let timerInterval = null;\n    let secondsElapsed = 0;\n    let firstClick = true;\n\n    const gridElement = document.getElementById('grid');\n    const mineCountElement = document.getElementById('mine-count');\n    const timerElement = document.getElementById('timer');\n    const messageElement = document.getElementById('message');\n    const newGameButton = document.getElementById('new-game');\n\n    function getNeighbors(row, col) {\n      const neighbors = [];\n      for (let dr = -1; dr <= 1; dr++) {\n        for (let dc = -1; dc <= 1; dc++) {\n          if (dr === 0 && dc === 0) continue;\n          const nr = row + dr, nc = col + dc;\n          if (nr >= 0 && nr < GRID_SIZE && nc >= 0 && nc < GRID_SIZE) {\n            neighbors.push([nr, nc]);\n          }\n        }\n      }\n      return neighbors;\n    }\n\n    function createGrid() {\n      grid = [];\n      for (let r = 0; r < GRID_SIZE; r++) {\n        grid[r] = [];\n        for (let c = 0; c < GRID_SIZE; c++) {\n          grid[r][c] = 0;\n        }\n      }\n      revealed.clear();\n      flagged.clear();\n      gameOver = false;\n      gameWon = false;\n      minesRemaining = MINE_COUNT;\n      firstClick = true;\n      secondsElapsed = 0;\n      updateMineCount();\n      updateTimer();\n      stopTimer();\n      messageElement.className = '';\n      messageElement.textContent = '';\n      messageElement.style.display = 'none';\n    }\n\n    function placeMines(excludeRow, excludeCol) {\n      let placed = 0;\n      while (placed < MINE_COUNT) {\n        const r = Math.floor(Math.random() * GRID_SIZE);\n        const c = Math.floor(Math.random() * GRID_SIZE);\n        if (grid[r][c] !== -1 && !(r === excludeRow && c === excludeCol)) {\n          grid[r][c] = -1;\n          placed++;\n        }\n      }\n    }\n\n    function calculateNumbers() {\n      for (let r = 0; r < GRID_SIZE; r++) {\n        for (let c = 0; c < GRID_SIZE; c++) {\n          if (grid[r][c] === -1) continue;\n          let count = 0;\n          for (const [nr, nc] of getNeighbors(r, c)) {\n            if (grid[nr][nc] === -1) count++;\n          }\n          grid[r][c] = count;\n        }\n      }\n    }\n\n    function getCellElement(row, col) {\n      return document.querySelector(`.cell[data-row=\"${row}\"][data-col=\"${col}\"]`);\n    }\n\n    function getCell(row, col) {\n      return getCellElement(row, col);\n    }\n\n    function revealCell(row, col) {\n      const key = row + ',' + col;\n      if (revealed.has(key) || flagged.has(key)) return;\n      \n      revealed.add(key);\n      const cell = getCell(row, col);\n      cell.classList.remove('hidden');\n      cell.classList.add('revealed');\n      \n      const count = grid[row][col];\n      if (count > 0) {\n        cell.textContent = count;\n        cell.classList.add('n' + count);\n      } else if (count === 0) {\n        cell.textContent = '';\n        for (const [nr, nc] of getNeighbors(row, col)) {\n          revealCell(nr, nc);\n        }\n      }\n    }\n\n    function revealMine(row, col) {\n      const cell = getCell(row, col);\n      cell.classList.remove('hidden');\n      cell.classList.add('mine');\n      cell.textContent = 'üí•';\n    }\n\n    function revealAllMines() {\n      for (let r = 0; r < GRID_SIZE; r++) {\n        for (let c = 0; c < GRID_SIZE; c++) {\n          if (grid[r][c] === -1) {\n            const cell = getCell(r, c);\n            cell.classList.remove('hidden', 'flagged');\n            cell.classList.add('mine');\n            cell.textContent = 'üí£';\n          }\n        }\n      }\n    }\n\n    function toggleFlag(row, col) {\n      if (gameOver) return;\n      const cellKey = `${row},${col}`;\n      if (revealed.has(cellKey)) return;\n      const cellElement = getCell(row, col);\n      if (flagged.has(cellKey)) {\n        flagged.delete(cellKey);\n        cellElement.classList.remove('flagged');\n        cellElement.classList.add('hidden');\n        cellElement.textContent = '';\n        minesRemaining++;\n      } else {\n        if (minesRemaining === 0) return;\n        flagged.add(cellKey);\n        cellElement.classList.remove('hidden');\n        cellElement.classList.add('flagged');\n        cellElement.textContent = 'üö©';\n        minesRemaining--;\n      }\n      updateMineCount();\n    }\n\n    function endGame(won) {\n      gameOver = true;\n      gameWon = won;\n      stopTimer();\n      revealAllMines();\n      showMessage(won ? 'You Win! üéâ' : 'Game Over üí•', won ? 'win' : 'lose');\n    }\n\n    function showMessage(text, type) {\n      messageElement.textContent = text;\n      messageElement.className = 'show ' + type;\n      messageElement.style.display = 'block';\n    }\n\n    function checkWin() {\n      if (gameOver) return;\n      const totalCells = GRID_SIZE * GRID_SIZE;\n      if (revealed.size === totalCells - MINE_COUNT) {\n        endGame(true);\n      }\n    }\n\n    function handleClick(row, col) {\n      if (gameOver) return;\n      const key = row + ',' + col;\n      if (flagged.has(key) || revealed.has(key)) return;\n      \n      if (firstClick) {\n        firstClick = false;\n        placeMines(row, col);\n        calculateNumbers();\n        startTimer();\n      }\n      \n      if (grid[row][col] === -1) {\n        revealMine(row, col);\n        endGame(false);\n        return;\n      }\n      \n      revealCell(row, col);\n      checkWin();\n    }\n\n    function handleRightClick(row, col, e) {\n      e.preventDefault();\n      if (gameOver) return;\n      const key = row + ',' + col;\n      if (revealed.has(key)) return;\n      \n      const cell = getCell(row, col);\n      if (flagged.has(key)) {\n        flagged.delete(key);\n        cell.textContent = '';\n        cell.classList.remove('flagged');\n        minesRemaining++;\n      } else {\n        if (minesRemaining === 0) return;\n        flagged.add(key);\n        cell.textContent = 'üö©';\n        cell.classList.add('flagged');\n        minesRemaining--;\n      }\n      updateMineCount();\n    }\n\n    function renderGrid() {\n      const gridEl = document.getElementById('grid');\n      gridEl.innerHTML = '';\n      for (let r = 0; r < GRID_SIZE; r++) {\n        for (let c = 0; c < GRID_SIZE; c++) {\n          const cell = document.createElement('div');\n          cell.className = 'cell hidden';\n          cell.dataset.row = r;\n          cell.dataset.col = c;\n          cell.setAttribute('role', 'button');\n          cell.setAttribute('tabindex', '0');\n          cell.setAttribute('aria-label', 'Hidden cell');\n          cell.addEventListener('click', () => handleClick(r, c));\n          cell.addEventListener('contextmenu', (e) => handleRightClick(r, c, e));\n          cell.addEventListener('keydown', (e) => {\n            if (gameOver) return;\n            if (e.key === 'Enter' || e.key === ' ') {\n              e.preventDefault();\n              handleClick(r, c);\n            } else if (e.key.toLowerCase() === 'f') {\n              e.preventDefault();\n              if (firstClick) return;\n              toggleFlag(r, c);\n            }\n          });\n          gridEl.appendChild(cell);\n        }\n      }\n    }\n\n    function updateMineCount() {\n      mineCountElement.textContent = minesRemaining;\n    }\n\n    function formatTime(secs) {\n      const m = Math.floor(secs / 60).toString().padStart(2, '0');\n      const s = (secs % 60).toString().padStart(2, '0');\n      return m + ':' + s;\n    }\n\n    function updateTimer() {\n      timerElement.textContent = formatTime(secondsElapsed);\n    }\n\n    function startTimer() {\n      if (timerInterval) return;\n      timerInterval = setInterval(() => { secondsElapsed++; updateTimer(); }, 1000);\n    }\n\n    function stopTimer() {\n      if (timerInterval) { clearInterval(timerInterval); timerInterval = null; }\n    }\n\n    function init() {\n      createGrid();\n      renderGrid();\n      updateMineCount();\n      updateTimer();\n    }\n\n    newGameButton.addEventListener('click', () => {\n      init();\n    });\n\n    init();\n  </script>\n</body>\n</html>",
      "samples": 1,
      "inputTokens": 4366,
      "outputTokens": 3489,
      "timeMs": 39284
    },
    {
      "step": 14,
      "action": "Add the game end functions:\nfunction endGame(won) ...",
      "code": "<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\" />\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\"/>\n  <title>Minesweeper</title>\n  <style>\n    * {\n      margin: 0;\n      padding: 0;\n      box-sizing: border-box;\n    }\n    body {\n      display: flex;\n      justify-content: center;\n      align-items: center;\n      background: #1a1a2e;\n      min-height: 100vh;\n      font-family: system-ui;\n    }\n    .container {\n      display: flex;\n      flex-direction: column;\n      align-items: center;\n      padding: 20px;\n      width: 100%;\n      max-width: 600px;\n    }\n    .header {\n      text-align: center;\n      margin-bottom: 20px;\n      color: white;\n      user-select: none;\n    }\n    h1 {\n      font-size: 2.5rem;\n      margin-bottom: 10px;\n      text-shadow: 0 0 10px cyan;\n    }\n    .stats {\n      display: flex;\n      gap: 30px;\n      font-size: 1.2rem;\n      justify-content: center;\n      margin-bottom: 10px;\n    }\n    .stat {\n      display: flex;\n      align-items: center;\n      gap: 8px;\n      color: white;\n    }\n    .stat-icon {\n      font-size: 1.3rem;\n      user-select: none;\n    }\n    .stat-value {\n      font-weight: bold;\n      min-width: 40px;\n      text-align: center;\n      font-family: monospace;\n    }\n    .grid {\n      display: grid;\n      grid-template-columns: repeat(16, 1fr);\n      gap: 2px;\n      background: #0f0f1a;\n      padding: 10px;\n      border-radius: 8px;\n      box-shadow: 0 0 20px rgba(0,255,255,0.1);\n      user-select: none;\n      width: 100%;\n      max-width: 448px;\n    }\n    .cell {\n      width: 28px;\n      height: 28px;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      font-weight: bold;\n      cursor: pointer;\n      border-radius: 4px;\n      transition: all 0.15s;\n      user-select: none;\n      font-family: monospace;\n      font-size: 16px;\n      line-height: 1;\n    }\n    .cell.hidden {\n      background: linear-gradient(145deg, #3a3a5c, #2a2a4c);\n    }\n    .cell.hidden:hover {\n      background: #4a4a6c;\n      transform: scale(1.05);\n    }\n    .cell.revealed {\n      background: #1a1a2e;\n      cursor: default;\n      box-shadow: inset 0 0 5px #00000088;\n      color: inherit;\n    }\n    .cell.flagged {\n      background: #4a3a5c;\n      color: #f1c40f;\n      cursor: pointer;\n      text-shadow: 0 0 3px #f1c40f;\n    }\n    .cell.mine {\n      background: #ff4757;\n      color: white;\n      cursor: default;\n      box-shadow: inset 0 0 5px #b03a47;\n    }\n    .n1 { color: #3498db; }\n    .n2 { color: #2ecc71; }\n    .n3 { color: #e74c3c; }\n    .n4 { color: #9b59b6; }\n    .n5 { color: #e67e22; }\n    .n6 { color: #1abc9c; }\n    .n7 { color: #34495e; }\n    .n8 { color: #7f8c8d; }\n\n    .controls {\n      margin-top: 20px;\n      display: flex;\n      gap: 15px;\n      justify-content: center;\n      width: 100%;\n      max-width: 448px;\n    }\n    button {\n      padding: 12px 24px;\n      font-size: 1rem;\n      border: none;\n      border-radius: 6px;\n      cursor: pointer;\n      background: #4a4a7c;\n      color: white;\n      transition: all 0.2s;\n      user-select: none;\n      flex: 1;\n    }\n    button:hover {\n      background: #5a5a9c;\n      transform: translateY(-2px);\n    }\n    #message {\n      position: fixed;\n      top: 50%;\n      left: 50%;\n      transform: translate(-50%, -50%);\n      padding: 30px 50px;\n      border-radius: 12px;\n      font-size: 2rem;\n      font-weight: bold;\n      z-index: 100;\n      display: none;\n      user-select: none;\n      text-align: center;\n      box-shadow: 0 0 20px rgba(0,0,0,0.5);\n      max-width: 90vw;\n      word-break: break-word;\n    }\n    #message.show {\n      display: block;\n      animation: fadeIn 0.3s;\n    }\n    #message.win {\n      background: #2ed573;\n      color: white;\n    }\n    #message.lose {\n      background: #ff4757;\n      color: white;\n    }\n    @keyframes fadeIn {\n      from {\n        opacity: 0;\n        transform: translate(-50%, -50%) scale(0.8);\n      }\n      to {\n        opacity: 1;\n        transform: translate(-50%, -50%) scale(1);\n      }\n    }\n  </style>\n</head>\n<body>\n  <div class=\"container\">\n    <div class=\"header\">\n      <h1>Minesweeper</h1>\n      <div class=\"stats\">\n        <div class=\"stat\"><span class=\"stat-icon\">üí£</span><span id=\"mine-count\" class=\"stat-value\">40</span></div>\n        <div class=\"stat\"><span class=\"stat-icon\">‚è±Ô∏è</span><span id=\"timer\" class=\"stat-value\">00:00</span></div>\n      </div>\n    </div>\n    <div id=\"grid\" class=\"grid\"></div>\n    <div class=\"controls\">\n      <button id=\"new-game\">New Game</button>\n    </div>\n    <div id=\"message\"></div>\n  </div>\n  <script>\n    const GRID_SIZE = 16;\n    const MINE_COUNT = 40;\n    let grid = [];\n    let revealed = new Set();\n    let flagged = new Set();\n    let gameOver = false;\n    let gameWon = false;\n    let minesRemaining = MINE_COUNT;\n    let timerInterval = null;\n    let secondsElapsed = 0;\n    let firstClick = true;\n\n    const gridElement = document.getElementById('grid');\n    const mineCountElement = document.getElementById('mine-count');\n    const timerElement = document.getElementById('timer');\n    const messageElement = document.getElementById('message');\n    const newGameButton = document.getElementById('new-game');\n\n    function getNeighbors(row, col) {\n      const neighbors = [];\n      for (let dr = -1; dr <= 1; dr++) {\n        for (let dc = -1; dc <= 1; dc++) {\n          if (dr === 0 && dc === 0) continue;\n          const nr = row + dr, nc = col + dc;\n          if (nr >= 0 && nr < GRID_SIZE && nc >= 0 && nc < GRID_SIZE) {\n            neighbors.push([nr, nc]);\n          }\n        }\n      }\n      return neighbors;\n    }\n\n    function createGrid() {\n      grid = [];\n      for (let r = 0; r < GRID_SIZE; r++) {\n        grid[r] = [];\n        for (let c = 0; c < GRID_SIZE; c++) {\n          grid[r][c] = 0;\n        }\n      }\n      revealed.clear();\n      flagged.clear();\n      gameOver = false;\n      gameWon = false;\n      minesRemaining = MINE_COUNT;\n      firstClick = true;\n      secondsElapsed = 0;\n      updateMineCount();\n      updateTimer();\n      stopTimer();\n      messageElement.className = '';\n      messageElement.textContent = '';\n      messageElement.style.display = 'none';\n    }\n\n    function placeMines(excludeRow, excludeCol) {\n      let placed = 0;\n      while (placed < MINE_COUNT) {\n        const r = Math.floor(Math.random() * GRID_SIZE);\n        const c = Math.floor(Math.random() * GRID_SIZE);\n        if (grid[r][c] !== -1 && !(r === excludeRow && c === excludeCol)) {\n          grid[r][c] = -1;\n          placed++;\n        }\n      }\n    }\n\n    function calculateNumbers() {\n      for (let r = 0; r < GRID_SIZE; r++) {\n        for (let c = 0; c < GRID_SIZE; c++) {\n          if (grid[r][c] === -1) continue;\n          let count = 0;\n          for (const [nr, nc] of getNeighbors(r, c)) {\n            if (grid[nr][nc] === -1) count++;\n          }\n          grid[r][c] = count;\n        }\n      }\n    }\n\n    function getCellElement(row, col) {\n      return document.querySelector(`.cell[data-row=\"${row}\"][data-col=\"${col}\"]`);\n    }\n\n    function getCell(row, col) {\n      return getCellElement(row, col);\n    }\n\n    function revealCell(row, col) {\n      const key = row + ',' + col;\n      if (revealed.has(key) || flagged.has(key)) return;\n      \n      revealed.add(key);\n      const cell = getCell(row, col);\n      cell.classList.remove('hidden');\n      cell.classList.add('revealed');\n      \n      const count = grid[row][col];\n      if (count > 0) {\n        cell.textContent = count;\n        cell.classList.add('n' + count);\n      } else if (count === 0) {\n        cell.textContent = '';\n        for (const [nr, nc] of getNeighbors(row, col)) {\n          revealCell(nr, nc);\n        }\n      }\n    }\n\n    function revealMine(row, col) {\n      const cell = getCell(row, col);\n      cell.classList.remove('hidden');\n      cell.classList.add('mine');\n      cell.textContent = 'üí•';\n    }\n\n    function revealAllMines() {\n      for (let r = 0; r < GRID_SIZE; r++) {\n        for (let c = 0; c < GRID_SIZE; c++) {\n          if (grid[r][c] === -1) {\n            const cell = getCell(r, c);\n            cell.classList.remove('hidden', 'flagged');\n            cell.classList.add('mine');\n            cell.textContent = 'üí£';\n          }\n        }\n      }\n    }\n\n    function toggleFlag(row, col) {\n      if (gameOver) return;\n      const cellKey = `${row},${col}`;\n      if (revealed.has(cellKey)) return;\n      const cellElement = getCell(row, col);\n      if (flagged.has(cellKey)) {\n        flagged.delete(cellKey);\n        cellElement.classList.remove('flagged');\n        cellElement.classList.add('hidden');\n        cellElement.textContent = '';\n        minesRemaining++;\n      } else {\n        if (minesRemaining === 0) return;\n        flagged.add(cellKey);\n        cellElement.classList.remove('hidden');\n        cellElement.classList.add('flagged');\n        cellElement.textContent = 'üö©';\n        minesRemaining--;\n      }\n      updateMineCount();\n    }\n\n    function endGame(won) {\n      gameOver = true;\n      gameWon = won;\n      stopTimer();\n      \n      const msg = document.getElementById('message');\n      if (won) {\n        msg.textContent = 'üéâ You Win!';\n        msg.className = 'show win';\n      } else {\n        revealAllMines();\n        msg.textContent = 'üí• Game Over!';\n        msg.className = 'show lose';\n      }\n    }\n\n    function checkWin() {\n      const totalCells = GRID_SIZE * GRID_SIZE;\n      const nonMineCells = totalCells - MINE_COUNT;\n      if (revealed.size === nonMineCells) {\n        endGame(true);\n      }\n    }\n\n    function hideMessage() {\n      document.getElementById('message').className = '';\n    }\n\n    function handleClick(row, col) {\n      if (gameOver) return;\n      const key = row + ',' + col;\n      if (flagged.has(key) || revealed.has(key)) return;\n      \n      if (firstClick) {\n        firstClick = false;\n        placeMines(row, col);\n        calculateNumbers();\n        startTimer();\n      }\n      \n      if (grid[row][col] === -1) {\n        revealMine(row, col);\n        endGame(false);\n        return;\n      }\n      \n      revealCell(row, col);\n      checkWin();\n    }\n\n    function handleRightClick(row, col, e) {\n      e.preventDefault();\n      if (gameOver) return;\n      const key = row + ',' + col;\n      if (revealed.has(key)) return;\n      \n      const cell = getCell(row, col);\n      if (flagged.has(key)) {\n        flagged.delete(key);\n        cell.textContent = '';\n        cell.classList.remove('flagged');\n        minesRemaining++;\n      } else {\n        if (minesRemaining === 0) return;\n        flagged.add(key);\n        cell.textContent = 'üö©';\n        cell.classList.add('flagged');\n        minesRemaining--;\n      }\n      updateMineCount();\n    }\n\n    function renderGrid() {\n      const gridEl = document.getElementById('grid');\n      gridEl.innerHTML = '';\n      for (let r = 0; r < GRID_SIZE; r++) {\n        for (let c = 0; c < GRID_SIZE; c++) {\n          const cell = document.createElement('div');\n          cell.className = 'cell hidden';\n          cell.dataset.row = r;\n          cell.dataset.col = c;\n          cell.setAttribute('role', 'button');\n          cell.setAttribute('tabindex', '0');\n          cell.setAttribute('aria-label', 'Hidden cell');\n          cell.addEventListener('click', () => handleClick(r, c));\n          cell.addEventListener('contextmenu', (e) => handleRightClick(r, c, e));\n          cell.addEventListener('keydown', (e) => {\n            if (gameOver) return;\n            if (e.key === 'Enter' || e.key === ' ') {\n              e.preventDefault();\n              handleClick(r, c);\n            } else if (e.key.toLowerCase() === 'f') {\n              e.preventDefault();\n              if (firstClick) return;\n              toggleFlag(r, c);\n            }\n          });\n          gridEl.appendChild(cell);\n        }\n      }\n    }\n\n    function updateMineCount() {\n      mineCountElement.textContent = minesRemaining;\n    }\n\n    function formatTime(secs) {\n      const m = Math.floor(secs / 60).toString().padStart(2, '0');\n      const s = (secs % 60).toString().padStart(2, '0');\n      return m + ':' + s;\n    }\n\n    function updateTimer() {\n      timerElement.textContent = formatTime(secondsElapsed);\n    }\n\n    function startTimer() {\n      if (timerInterval) return;\n      timerInterval = setInterval(() => { secondsElapsed++; updateTimer(); }, 1000);\n    }\n\n    function stopTimer() {\n      if (timerInterval) { clearInterval(timerInterval); timerInterval = null; }\n    }\n\n    function init() {\n      createGrid();\n      renderGrid();\n      updateMineCount();\n      updateTimer();\n    }\n\n    newGameButton.addEventListener('click', () => {\n      init();\n    });\n\n    init();\n  </script>\n</body>\n</html>",
      "samples": 1,
      "inputTokens": 4025,
      "outputTokens": 3508,
      "timeMs": 63396
    },
    {
      "step": 15,
      "action": "Add the init and reset functions, plus event liste...",
      "code": "<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\" />\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\"/>\n  <title>Minesweeper</title>\n  <style>\n    * {\n      margin: 0;\n      padding: 0;\n      box-sizing: border-box;\n    }\n    body {\n      display: flex;\n      justify-content: center;\n      align-items: center;\n      background: #1a1a2e;\n      min-height: 100vh;\n      font-family: system-ui;\n    }\n    .container {\n      display: flex;\n      flex-direction: column;\n      align-items: center;\n      padding: 20px;\n      width: 100%;\n      max-width: 600px;\n    }\n    .header {\n      text-align: center;\n      margin-bottom: 20px;\n      color: white;\n      user-select: none;\n    }\n    h1 {\n      font-size: 2.5rem;\n      margin-bottom: 10px;\n      text-shadow: 0 0 10px cyan;\n    }\n    .stats {\n      display: flex;\n      gap: 30px;\n      font-size: 1.2rem;\n      justify-content: center;\n      margin-bottom: 10px;\n    }\n    .stat {\n      display: flex;\n      align-items: center;\n      gap: 8px;\n      color: white;\n    }\n    .stat-icon {\n      font-size: 1.3rem;\n      user-select: none;\n    }\n    .stat-value {\n      font-weight: bold;\n      min-width: 40px;\n      text-align: center;\n      font-family: monospace;\n    }\n    .grid {\n      display: grid;\n      grid-template-columns: repeat(16, 1fr);\n      gap: 2px;\n      background: #0f0f1a;\n      padding: 10px;\n      border-radius: 8px;\n      box-shadow: 0 0 20px rgba(0,255,255,0.1);\n      user-select: none;\n      width: 100%;\n      max-width: 448px;\n    }\n    .cell {\n      width: 28px;\n      height: 28px;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      font-weight: bold;\n      cursor: pointer;\n      border-radius: 4px;\n      transition: all 0.15s;\n      user-select: none;\n      font-family: monospace;\n      font-size: 16px;\n      line-height: 1;\n    }\n    .cell.hidden {\n      background: linear-gradient(145deg, #3a3a5c, #2a2a4c);\n    }\n    .cell.hidden:hover {\n      background: #4a4a6c;\n      transform: scale(1.05);\n    }\n    .cell.revealed {\n      background: #1a1a2e;\n      cursor: default;\n      box-shadow: inset 0 0 5px #00000088;\n      color: inherit;\n    }\n    .cell.flagged {\n      background: #4a3a5c;\n      color: #f1c40f;\n      cursor: pointer;\n      text-shadow: 0 0 3px #f1c40f;\n    }\n    .cell.mine {\n      background: #ff4757;\n      color: white;\n      cursor: default;\n      box-shadow: inset 0 0 5px #b03a47;\n    }\n    .n1 { color: #3498db; }\n    .n2 { color: #2ecc71; }\n    .n3 { color: #e74c3c; }\n    .n4 { color: #9b59b6; }\n    .n5 { color: #e67e22; }\n    .n6 { color: #1abc9c; }\n    .n7 { color: #34495e; }\n    .n8 { color: #7f8c8d; }\n\n    .controls {\n      margin-top: 20px;\n      display: flex;\n      gap: 15px;\n      justify-content: center;\n      width: 100%;\n      max-width: 448px;\n    }\n    button {\n      padding: 12px 24px;\n      font-size: 1rem;\n      border: none;\n      border-radius: 6px;\n      cursor: pointer;\n      background: #4a4a7c;\n      color: white;\n      transition: all 0.2s;\n      user-select: none;\n      flex: 1;\n    }\n    button:hover {\n      background: #5a5a9c;\n      transform: translateY(-2px);\n    }\n    #message {\n      position: fixed;\n      top: 50%;\n      left: 50%;\n      transform: translate(-50%, -50%);\n      padding: 30px 50px;\n      border-radius: 12px;\n      font-size: 2rem;\n      font-weight: bold;\n      z-index: 100;\n      display: none;\n      user-select: none;\n      text-align: center;\n      box-shadow: 0 0 20px rgba(0,0,0,0.5);\n      max-width: 90vw;\n      word-break: break-word;\n      cursor: pointer;\n    }\n    #message.show {\n      display: block;\n      animation: fadeIn 0.3s;\n    }\n    #message.win {\n      background: #2ed573;\n      color: white;\n    }\n    #message.lose {\n      background: #ff4757;\n      color: white;\n    }\n    @keyframes fadeIn {\n      from {\n        opacity: 0;\n        transform: translate(-50%, -50%) scale(0.8);\n      }\n      to {\n        opacity: 1;\n        transform: translate(-50%, -50%) scale(1);\n      }\n    }\n  </style>\n</head>\n<body>\n  <div class=\"container\">\n    <div class=\"header\">\n      <h1>Minesweeper</h1>\n      <div class=\"stats\">\n        <div class=\"stat\"><span class=\"stat-icon\">üí£</span><span id=\"mine-count\" class=\"stat-value\">40</span></div>\n        <div class=\"stat\"><span class=\"stat-icon\">‚è±Ô∏è</span><span id=\"timer\" class=\"stat-value\">00:00</span></div>\n      </div>\n    </div>\n    <div id=\"grid\" class=\"grid\"></div>\n    <div class=\"controls\">\n      <button id=\"new-game\">New Game</button>\n    </div>\n    <div id=\"message\"></div>\n  </div>\n  <script>\n    const GRID_SIZE = 16;\n    const MINE_COUNT = 40;\n    let grid = [];\n    let revealed = new Set();\n    let flagged = new Set();\n    let gameOver = false;\n    let gameWon = false;\n    let minesRemaining = MINE_COUNT;\n    let timerInterval = null;\n    let secondsElapsed = 0;\n    let firstClick = true;\n\n    const gridElement = document.getElementById('grid');\n    const mineCountElement = document.getElementById('mine-count');\n    const timerElement = document.getElementById('timer');\n    const messageElement = document.getElementById('message');\n    const newGameButton = document.getElementById('new-game');\n\n    function getNeighbors(row, col) {\n      const neighbors = [];\n      for (let dr = -1; dr <= 1; dr++) {\n        for (let dc = -1; dc <= 1; dc++) {\n          if (dr === 0 && dc === 0) continue;\n          const nr = row + dr, nc = col + dc;\n          if (nr >= 0 && nr < GRID_SIZE && nc >= 0 && nc < GRID_SIZE) {\n            neighbors.push([nr, nc]);\n          }\n        }\n      }\n      return neighbors;\n    }\n\n    function createGrid() {\n      grid = [];\n      for (let r = 0; r < GRID_SIZE; r++) {\n        grid[r] = [];\n        for (let c = 0; c < GRID_SIZE; c++) {\n          grid[r][c] = 0;\n        }\n      }\n      revealed.clear();\n      flagged.clear();\n      gameOver = false;\n      gameWon = false;\n      minesRemaining = MINE_COUNT;\n      firstClick = true;\n      secondsElapsed = 0;\n      updateMineCount();\n      updateTimer();\n      stopTimer();\n      messageElement.className = '';\n      messageElement.textContent = '';\n      messageElement.style.display = 'none';\n    }\n\n    function placeMines(excludeRow, excludeCol) {\n      let placed = 0;\n      while (placed < MINE_COUNT) {\n        const r = Math.floor(Math.random() * GRID_SIZE);\n        const c = Math.floor(Math.random() * GRID_SIZE);\n        if (grid[r][c] !== -1 && !(r === excludeRow && c === excludeCol)) {\n          grid[r][c] = -1;\n          placed++;\n        }\n      }\n    }\n\n    function calculateNumbers() {\n      for (let r = 0; r < GRID_SIZE; r++) {\n        for (let c = 0; c < GRID_SIZE; c++) {\n          if (grid[r][c] === -1) continue;\n          let count = 0;\n          for (const [nr, nc] of getNeighbors(r, c)) {\n            if (grid[nr][nc] === -1) count++;\n          }\n          grid[r][c] = count;\n        }\n      }\n    }\n\n    function getCellElement(row, col) {\n      return document.querySelector(`.cell[data-row=\"${row}\"][data-col=\"${col}\"]`);\n    }\n\n    function getCell(row, col) {\n      return getCellElement(row, col);\n    }\n\n    function revealCell(row, col) {\n      const key = row + ',' + col;\n      if (revealed.has(key) || flagged.has(key)) return;\n      \n      revealed.add(key);\n      const cell = getCell(row, col);\n      cell.classList.remove('hidden');\n      cell.classList.add('revealed');\n      \n      const count = grid[row][col];\n      if (count > 0) {\n        cell.textContent = count;\n        cell.classList.add('n' + count);\n      } else if (count === 0) {\n        cell.textContent = '';\n        for (const [nr, nc] of getNeighbors(row, col)) {\n          revealCell(nr, nc);\n        }\n      }\n    }\n\n    function revealMine(row, col) {\n      const cell = getCell(row, col);\n      cell.classList.remove('hidden');\n      cell.classList.add('mine');\n      cell.textContent = 'üí•';\n    }\n\n    function revealAllMines() {\n      for (let r = 0; r < GRID_SIZE; r++) {\n        for (let c = 0; c < GRID_SIZE; c++) {\n          if (grid[r][c] === -1) {\n            const cell = getCell(r, c);\n            cell.classList.remove('hidden', 'flagged');\n            cell.classList.add('mine');\n            cell.textContent = 'üí£';\n          }\n        }\n      }\n    }\n\n    function toggleFlag(row, col) {\n      if (gameOver) return;\n      const cellKey = `${row},${col}`;\n      if (revealed.has(cellKey)) return;\n      const cellElement = getCell(row, col);\n      if (flagged.has(cellKey)) {\n        flagged.delete(cellKey);\n        cellElement.classList.remove('flagged');\n        cellElement.classList.add('hidden');\n        cellElement.textContent = '';\n        minesRemaining++;\n      } else {\n        if (minesRemaining === 0) return;\n        flagged.add(cellKey);\n        cellElement.classList.remove('hidden');\n        cellElement.classList.add('flagged');\n        cellElement.textContent = 'üö©';\n        minesRemaining--;\n      }\n      updateMineCount();\n    }\n\n    function endGame(won) {\n      gameOver = true;\n      gameWon = won;\n      stopTimer();\n      \n      const msg = document.getElementById('message');\n      if (won) {\n        msg.textContent = 'üéâ You Win!';\n        msg.className = 'show win';\n      } else {\n        revealAllMines();\n        msg.textContent = 'üí• Game Over!';\n        msg.className = 'show lose';\n      }\n    }\n\n    function checkWin() {\n      const totalCells = GRID_SIZE * GRID_SIZE;\n      const nonMineCells = totalCells - MINE_COUNT;\n      if (revealed.size === nonMineCells) {\n        endGame(true);\n      }\n    }\n\n    function hideMessage() {\n      const msg = document.getElementById('message');\n      msg.className = '';\n      msg.textContent = '';\n      msg.style.display = 'none';\n    }\n\n    function handleClick(row, col) {\n      if (gameOver) return;\n      const key = row + ',' + col;\n      if (flagged.has(key) || revealed.has(key)) return;\n      \n      if (firstClick) {\n        firstClick = false;\n        placeMines(row, col);\n        calculateNumbers();\n        startTimer();\n      }\n      \n      if (grid[row][col] === -1) {\n        revealMine(row, col);\n        endGame(false);\n        return;\n      }\n      \n      revealCell(row, col);\n      checkWin();\n    }\n\n    function handleRightClick(row, col, e) {\n      e.preventDefault();\n      if (gameOver) return;\n      const key = row + ',' + col;\n      if (revealed.has(key)) return;\n      \n      const cell = getCell(row, col);\n      if (flagged.has(key)) {\n        flagged.delete(key);\n        cell.textContent = '';\n        cell.classList.remove('flagged');\n        minesRemaining++;\n      } else {\n        if (minesRemaining === 0) return;\n        flagged.add(key);\n        cell.textContent = 'üö©';\n        cell.classList.add('flagged');\n        minesRemaining--;\n      }\n      updateMineCount();\n    }\n\n    function renderGrid() {\n      const gridEl = document.getElementById('grid');\n      gridEl.innerHTML = '';\n      for (let r = 0; r < GRID_SIZE; r++) {\n        for (let c = 0; c < GRID_SIZE; c++) {\n          const cell = document.createElement('div');\n          cell.className = 'cell hidden';\n          cell.dataset.row = r;\n          cell.dataset.col = c;\n          cell.setAttribute('role', 'button');\n          cell.setAttribute('tabindex', '0');\n          cell.setAttribute('aria-label', 'Hidden cell');\n          cell.addEventListener('click', () => handleClick(r, c));\n          cell.addEventListener('contextmenu', (e) => handleRightClick(r, c, e));\n          cell.addEventListener('keydown', (e) => {\n            if (gameOver) return;\n            if (e.key === 'Enter' || e.key === ' ') {\n              e.preventDefault();\n              handleClick(r, c);\n            } else if (e.key.toLowerCase() === 'f') {\n              e.preventDefault();\n              if (firstClick) return;\n              toggleFlag(r, c);\n            }\n          });\n          gridEl.appendChild(cell);\n        }\n      }\n    }\n\n    function updateMineCount() {\n      mineCountElement.textContent = minesRemaining;\n    }\n\n    function formatTime(secs) {\n      const m = Math.floor(secs / 60).toString().padStart(2, '0');\n      const s = (secs % 60).toString().padStart(2, '0');\n      return m + ':' + s;\n    }\n\n    function updateTimer() {\n      timerElement.textContent = formatTime(secondsElapsed);\n    }\n\n    function startTimer() {\n      if (timerInterval) return;\n      timerInterval = setInterval(() => { secondsElapsed++; updateTimer(); }, 1000);\n    }\n\n    function stopTimer() {\n      if (timerInterval) { clearInterval(timerInterval); timerInterval = null; }\n    }\n\n    function initGame() {\n      grid = [];\n      revealed = new Set();\n      flagged = new Set();\n      gameOver = false;\n      gameWon = false;\n      minesRemaining = MINE_COUNT;\n      secondsElapsed = 0;\n      firstClick = true;\n      stopTimer();\n      updateTimer();\n      updateMineCount();\n      createGrid();\n      renderGrid();\n      hideMessage();\n    }\n\n    newGameButton.addEventListener('click', initGame);\n    messageElement.addEventListener('click', hideMessage);\n    document.addEventListener('DOMContentLoaded', initGame);\n  </script>\n</body>\n</html>",
      "samples": 1,
      "inputTokens": 4012,
      "outputTokens": 3606,
      "timeMs": 45655
    },
    {
      "step": 16,
      "action": "Add these CSS animation styles:\n1. @keyframes puls...",
      "code": "<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\" />\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\"/>\n  <title>Minesweeper</title>\n  <style>\n    * {\n      margin: 0;\n      padding: 0;\n      box-sizing: border-box;\n    }\n    body {\n      display: flex;\n      justify-content: center;\n      align-items: center;\n      background: #1a1a2e;\n      min-height: 100vh;\n      font-family: system-ui;\n    }\n    .container {\n      display: flex;\n      flex-direction: column;\n      align-items: center;\n      padding: 20px;\n      width: 100%;\n      max-width: 600px;\n    }\n    .header {\n      text-align: center;\n      margin-bottom: 20px;\n      color: white;\n      user-select: none;\n    }\n    h1 {\n      font-size: 2.5rem;\n      margin-bottom: 10px;\n      text-shadow: 0 0 10px cyan;\n    }\n    .stats {\n      display: flex;\n      gap: 30px;\n      font-size: 1.2rem;\n      justify-content: center;\n      margin-bottom: 10px;\n    }\n    .stat {\n      display: flex;\n      align-items: center;\n      gap: 8px;\n      color: white;\n    }\n    .stat-icon {\n      font-size: 1.3rem;\n      user-select: none;\n    }\n    .stat-value {\n      font-weight: bold;\n      min-width: 40px;\n      text-align: center;\n      font-family: monospace;\n    }\n    .grid {\n      display: grid;\n      grid-template-columns: repeat(16, 1fr);\n      gap: 2px;\n      background: #0f0f1a;\n      padding: 10px;\n      border-radius: 8px;\n      box-shadow: 0 0 20px rgba(0,255,255,0.1);\n      user-select: none;\n      width: 100%;\n      max-width: 448px;\n    }\n    .cell {\n      width: 28px;\n      height: 28px;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      font-weight: bold;\n      cursor: pointer;\n      border-radius: 4px;\n      transition: all 0.15s;\n      user-select: none;\n      font-family: monospace;\n      font-size: 16px;\n      line-height: 1;\n    }\n    .cell.hidden {\n      background: linear-gradient(145deg, #3a3a5c, #2a2a4c);\n    }\n    .cell.hidden:hover {\n      background: #4a4a6c;\n      transform: scale(1.05);\n    }\n    .cell.revealed {\n      background: #1a1a2e;\n      cursor: default;\n      box-shadow: inset 0 0 5px #00000088;\n      color: inherit;\n      animation: reveal 0.2s ease-out;\n    }\n    .cell.flagged {\n      background: #4a3a5c;\n      color: #f1c40f;\n      cursor: pointer;\n      text-shadow: 0 0 3px #f1c40f;\n    }\n    .cell.mine {\n      background: #ff4757;\n      color: white;\n      cursor: default;\n      box-shadow: inset 0 0 5px #b03a47;\n      animation: pulse 0.5s ease-in-out;\n    }\n    .n1 { color: #3498db; }\n    .n2 { color: #2ecc71; }\n    .n3 { color: #e74c3c; }\n    .n4 { color: #9b59b6; }\n    .n5 { color: #e67e22; }\n    .n6 { color: #1abc9c; }\n    .n7 { color: #34495e; }\n    .n8 { color: #7f8c8d; }\n\n    .controls {\n      margin-top: 20px;\n      display: flex;\n      gap: 15px;\n      justify-content: center;\n      width: 100%;\n      max-width: 448px;\n    }\n    button {\n      padding: 12px 24px;\n      font-size: 1rem;\n      border: none;\n      border-radius: 6px;\n      cursor: pointer;\n      background: #4a4a7c;\n      color: white;\n      transition: all 0.2s;\n      user-select: none;\n      flex: 1;\n    }\n    button:hover {\n      background: #5a5a9c;\n      transform: translateY(-2px);\n    }\n    #message {\n      position: fixed;\n      top: 50%;\n      left: 50%;\n      transform: translate(-50%, -50%);\n      padding: 30px 50px;\n      border-radius: 12px;\n      font-size: 2rem;\n      font-weight: bold;\n      z-index: 100;\n      display: none;\n      user-select: none;\n      text-align: center;\n      box-shadow: 0 0 20px rgba(0,0,0,0.5);\n      max-width: 90vw;\n      word-break: break-word;\n      cursor: pointer;\n    }\n    #message.show {\n      display: block;\n      animation: fadeIn 0.3s;\n    }\n    #message.win {\n      background: #2ed573;\n      color: white;\n    }\n    #message.lose {\n      background: #ff4757;\n      color: white;\n    }\n    @keyframes fadeIn {\n      from {\n        opacity: 0;\n        transform: translate(-50%, -50%) scale(0.8);\n      }\n      to {\n        opacity: 1;\n        transform: translate(-50%, -50%) scale(1);\n      }\n    }\n    @keyframes pulse {\n      0%, 100% {\n        transform: scale(1);\n      }\n      50% {\n        transform: scale(1.1);\n      }\n    }\n    @keyframes reveal {\n      from {\n        transform: scale(0.8);\n        opacity: 0;\n      }\n      to {\n        transform: scale(1);\n        opacity: 1;\n      }\n    }\n  </style>\n</head>\n<body>\n  <div class=\"container\">\n    <div class=\"header\">\n      <h1>Minesweeper</h1>\n      <div class=\"stats\">\n        <div class=\"stat\"><span class=\"stat-icon\">üí£</span><span id=\"mine-count\" class=\"stat-value\">40</span></div>\n        <div class=\"stat\"><span class=\"stat-icon\">‚è±Ô∏è</span><span id=\"timer\" class=\"stat-value\">00:00</span></div>\n      </div>\n    </div>\n    <div id=\"grid\" class=\"grid\"></div>\n    <div class=\"controls\">\n      <button id=\"new-game\">New Game</button>\n    </div>\n    <div id=\"message\"></div>\n  </div>\n  <script>\n    const GRID_SIZE = 16;\n    const MINE_COUNT = 40;\n    let grid = [];\n    let revealed = new Set();\n    let flagged = new Set();\n    let gameOver = false;\n    let gameWon = false;\n    let minesRemaining = MINE_COUNT;\n    let timerInterval = null;\n    let secondsElapsed = 0;\n    let firstClick = true;\n\n    const gridElement = document.getElementById('grid');\n    const mineCountElement = document.getElementById('mine-count');\n    const timerElement = document.getElementById('timer');\n    const messageElement = document.getElementById('message');\n    const newGameButton = document.getElementById('new-game');\n\n    function getNeighbors(row, col) {\n      const neighbors = [];\n      for (let dr = -1; dr <= 1; dr++) {\n        for (let dc = -1; dc <= 1; dc++) {\n          if (dr === 0 && dc === 0) continue;\n          const nr = row + dr, nc = col + dc;\n          if (nr >= 0 && nr < GRID_SIZE && nc >= 0 && nc < GRID_SIZE) {\n            neighbors.push([nr, nc]);\n          }\n        }\n      }\n      return neighbors;\n    }\n\n    function createGrid() {\n      grid = [];\n      for (let r = 0; r < GRID_SIZE; r++) {\n        grid[r] = [];\n        for (let c = 0; c < GRID_SIZE; c++) {\n          grid[r][c] = 0;\n        }\n      }\n      revealed.clear();\n      flagged.clear();\n      gameOver = false;\n      gameWon = false;\n      minesRemaining = MINE_COUNT;\n      firstClick = true;\n      secondsElapsed = 0;\n      updateMineCount();\n      updateTimer();\n      stopTimer();\n      messageElement.className = '';\n      messageElement.textContent = '';\n      messageElement.style.display = 'none';\n    }\n\n    function placeMines(excludeRow, excludeCol) {\n      let placed = 0;\n      while (placed < MINE_COUNT) {\n        const r = Math.floor(Math.random() * GRID_SIZE);\n        const c = Math.floor(Math.random() * GRID_SIZE);\n        if (grid[r][c] !== -1 && !(r === excludeRow && c === excludeCol)) {\n          grid[r][c] = -1;\n          placed++;\n        }\n      }\n    }\n\n    function calculateNumbers() {\n      for (let r = 0; r < GRID_SIZE; r++) {\n        for (let c = 0; c < GRID_SIZE; c++) {\n          if (grid[r][c] === -1) continue;\n          let count = 0;\n          for (const [nr, nc] of getNeighbors(r, c)) {\n            if (grid[nr][nc] === -1) count++;\n          }\n          grid[r][c] = count;\n        }\n      }\n    }\n\n    function getCellElement(row, col) {\n      return document.querySelector(`.cell[data-row=\"${row}\"][data-col=\"${col}\"]`);\n    }\n\n    function getCell(row, col) {\n      return getCellElement(row, col);\n    }\n\n    function revealCell(row, col) {\n      const key = row + ',' + col;\n      if (revealed.has(key) || flagged.has(key)) return;\n      \n      revealed.add(key);\n      const cell = getCell(row, col);\n      cell.classList.remove('hidden');\n      cell.classList.add('revealed');\n      \n      const count = grid[row][col];\n      if (count > 0) {\n        cell.textContent = count;\n        cell.classList.add('n' + count);\n      } else if (count === 0) {\n        cell.textContent = '';\n        for (const [nr, nc] of getNeighbors(row, col)) {\n          revealCell(nr, nc);\n        }\n      }\n    }\n\n    function revealMine(row, col) {\n      const cell = getCell(row, col);\n      cell.classList.remove('hidden');\n      cell.classList.add('mine');\n      cell.textContent = 'üí•';\n    }\n\n    function revealAllMines() {\n      for (let r = 0; r < GRID_SIZE; r++) {\n        for (let c = 0; c < GRID_SIZE; c++) {\n          if (grid[r][c] === -1) {\n            const cell = getCell(r, c);\n            cell.classList.remove('hidden', 'flagged');\n            cell.classList.add('mine');\n            cell.textContent = 'üí£';\n          }\n        }\n      }\n    }\n\n    function toggleFlag(row, col) {\n      if (gameOver) return;\n      const cellKey = `${row},${col}`;\n      if (revealed.has(cellKey)) return;\n      const cellElement = getCell(row, col);\n      if (flagged.has(cellKey)) {\n        flagged.delete(cellKey);\n        cellElement.classList.remove('flagged');\n        cellElement.classList.add('hidden');\n        cellElement.textContent = '';\n        minesRemaining++;\n      } else {\n        if (minesRemaining === 0) return;\n        flagged.add(cellKey);\n        cellElement.classList.remove('hidden');\n        cellElement.classList.add('flagged');\n        cellElement.textContent = 'üö©';\n        minesRemaining--;\n      }\n      updateMineCount();\n    }\n\n    function endGame(won) {\n      gameOver = true;\n      gameWon = won;\n      stopTimer();\n      \n      const msg = document.getElementById('message');\n      if (won) {\n        msg.textContent = 'üéâ You Win!';\n        msg.className = 'show win';\n      } else {\n        revealAllMines();\n        msg.textContent = 'üí• Game Over!';\n        msg.className = 'show lose';\n      }\n    }\n\n    function checkWin() {\n      const totalCells = GRID_SIZE * GRID_SIZE;\n      const nonMineCells = totalCells - MINE_COUNT;\n      if (revealed.size === nonMineCells) {\n        endGame(true);\n      }\n    }\n\n    function hideMessage() {\n      const msg = document.getElementById('message');\n      msg.className = '';\n      msg.textContent = '';\n      msg.style.display = 'none';\n    }\n\n    function handleClick(row, col) {\n      if (gameOver) return;\n      const key = row + ',' + col;\n      if (flagged.has(key) || revealed.has(key)) return;\n      \n      if (firstClick) {\n        firstClick = false;\n        placeMines(row, col);\n        calculateNumbers();\n        startTimer();\n      }\n      \n      if (grid[row][col] === -1) {\n        revealMine(row, col);\n        endGame(false);\n        return;\n      }\n      \n      revealCell(row, col);\n      checkWin();\n    }\n\n    function handleRightClick(row, col, e) {\n      e.preventDefault();\n      if (gameOver) return;\n      const key = row + ',' + col;\n      if (revealed.has(key)) return;\n      \n      const cell = getCell(row, col);\n      if (flagged.has(key)) {\n        flagged.delete(key);\n        cell.textContent = '';\n        cell.classList.remove('flagged');\n        minesRemaining++;\n      } else {\n        if (minesRemaining === 0) return;\n        flagged.add(key);\n        cell.textContent = 'üö©';\n        cell.classList.add('flagged');\n        minesRemaining--;\n      }\n      updateMineCount();\n    }\n\n    function renderGrid() {\n      const gridEl = document.getElementById('grid');\n      gridEl.innerHTML = '';\n      for (let r = 0; r < GRID_SIZE; r++) {\n        for (let c = 0; c < GRID_SIZE; c++) {\n          const cell = document.createElement('div');\n          cell.className = 'cell hidden';\n          cell.dataset.row = r;\n          cell.dataset.col = c;\n          cell.setAttribute('role', 'button');\n          cell.setAttribute('tabindex', '0');\n          cell.setAttribute('aria-label', 'Hidden cell');\n          cell.addEventListener('click', () => handleClick(r, c));\n          cell.addEventListener('contextmenu', (e) => handleRightClick(r, c, e));\n          cell.addEventListener('keydown', (e) => {\n            if (gameOver) return;\n            if (e.key === 'Enter' || e.key === ' ') {\n              e.preventDefault();\n              handleClick(r, c);\n            } else if (e.key.toLowerCase() === 'f') {\n              e.preventDefault();\n              if (firstClick) return;\n              toggleFlag(r, c);\n            }\n          });\n          gridEl.appendChild(cell);\n        }\n      }\n    }\n\n    function updateMineCount() {\n      mineCountElement.textContent = minesRemaining;\n    }\n\n    function formatTime(secs) {\n      const m = Math.floor(secs / 60).toString().padStart(2, '0');\n      const s = (secs % 60).toString().padStart(2, '0');\n      return m + ':' + s;\n    }\n\n    function updateTimer() {\n      timerElement.textContent = formatTime(secondsElapsed);\n    }\n\n    function startTimer() {\n      if (timerInterval) return;\n      timerInterval = setInterval(() => { secondsElapsed++; updateTimer(); }, 1000);\n    }\n\n    function stopTimer() {\n      if (timerInterval) { clearInterval(timerInterval); timerInterval = null; }\n    }\n\n    function initGame() {\n      grid = [];\n      revealed = new Set();\n      flagged = new Set();\n      gameOver = false;\n      gameWon = false;\n      minesRemaining = MINE_COUNT;\n      secondsElapsed = 0;\n      firstClick = true;\n      stopTimer();\n      updateTimer();\n      updateMineCount();\n      createGrid();\n      renderGrid();\n      hideMessage();\n    }\n\n    newGameButton.addEventListener('click', initGame);\n    messageElement.addEventListener('click', hideMessage);\n    document.addEventListener('DOMContentLoaded', initGame);\n  </script>\n</body>\n</html>",
      "samples": 1,
      "inputTokens": 4091,
      "outputTokens": 3718,
      "timeMs": 46027
    },
    {
      "step": 17,
      "action": "Add these final CSS polish styles:\n1. body: backgr...",
      "code": "<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\" />\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\"/>\n  <title>Minesweeper</title>\n  <style>\n    * {\n      margin: 0;\n      padding: 0;\n      box-sizing: border-box;\n    }\n    body {\n      display: flex;\n      justify-content: center;\n      align-items: center;\n      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);\n      min-height: 100vh;\n      font-family: system-ui;\n    }\n    .container {\n      display: flex;\n      flex-direction: column;\n      align-items: center;\n      padding: 20px;\n      width: 100%;\n      max-width: 600px;\n    }\n    .header {\n      text-align: center;\n      margin-bottom: 20px;\n      color: white;\n      user-select: none;\n    }\n    h1 {\n      font-size: 2.5rem;\n      margin-bottom: 10px;\n      text-shadow: 0 0 10px cyan;\n    }\n    .stats {\n      display: flex;\n      gap: 30px;\n      font-size: 1.2rem;\n      justify-content: center;\n      margin-bottom: 10px;\n    }\n    .stat {\n      display: flex;\n      align-items: center;\n      gap: 8px;\n      color: white;\n    }\n    .stat-icon {\n      font-size: 1.3rem;\n      user-select: none;\n    }\n    .stat-value {\n      font-weight: bold;\n      min-width: 40px;\n      text-align: center;\n      font-family: monospace;\n      text-shadow: 0 0 5px rgba(255,255,255,0.3);\n    }\n    .grid {\n      display: grid;\n      grid-template-columns: repeat(16, 1fr);\n      gap: 2px;\n      background: #0f0f1a;\n      padding: 10px;\n      border-radius: 8px;\n      box-shadow: 0 0 20px rgba(0,255,255,0.1);\n      user-select: none;\n      width: 100%;\n      max-width: 448px;\n      transition: box-shadow 0.3s ease;\n    }\n    .grid:hover {\n      box-shadow: 0 0 30px rgba(0,255,255,0.2);\n    }\n    .cell {\n      width: 28px;\n      height: 28px;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      font-weight: bold;\n      cursor: pointer;\n      border-radius: 4px;\n      transition: all 0.15s;\n      user-select: none;\n      font-family: monospace;\n      font-size: 16px;\n      line-height: 1;\n      border: 1px solid rgba(255,255,255,0.05);\n    }\n    .cell.hidden {\n      background: linear-gradient(145deg, #3a3a5c, #2a2a4c);\n    }\n    .cell.hidden:hover {\n      background: #4a4a6c;\n      transform: scale(1.05);\n    }\n    .cell.revealed {\n      background: #1a1a2e;\n      cursor: default;\n      box-shadow: inset 0 0 5px #00000088;\n      color: inherit;\n      animation: reveal 0.2s ease-out;\n    }\n    .cell.flagged {\n      background: #4a3a5c;\n      color: #f1c40f;\n      cursor: pointer;\n      text-shadow: 0 0 3px #f1c40f;\n    }\n    .cell.mine {\n      background: #ff4757;\n      color: white;\n      cursor: default;\n      box-shadow: inset 0 0 5px #b03a47;\n      animation: pulse 0.5s ease-in-out;\n    }\n    .n1 { color: #3498db; }\n    .n2 { color: #2ecc71; }\n    .n3 { color: #e74c3c; }\n    .n4 { color: #9b59b6; }\n    .n5 { color: #e67e22; }\n    .n6 { color: #1abc9c; }\n    .n7 { color: #34495e; }\n    .n8 { color: #7f8c8d; }\n\n    .controls {\n      margin-top: 20px;\n      display: flex;\n      gap: 15px;\n      justify-content: center;\n      width: 100%;\n      max-width: 448px;\n    }\n    button {\n      padding: 12px 24px;\n      font-size: 1rem;\n      border: none;\n      border-radius: 6px;\n      cursor: pointer;\n      background: #4a4a7c;\n      color: white;\n      transition: all 0.2s;\n      user-select: none;\n      flex: 1;\n    }\n    button:hover {\n      background: #5a5a9c;\n      transform: translateY(-2px);\n    }\n    button:active {\n      transform: translateY(0);\n    }\n    #message {\n      position: fixed;\n      top: 50%;\n      left: 50%;\n      transform: translate(-50%, -50%);\n      padding: 30px 50px;\n      border-radius: 12px;\n      font-size: 2rem;\n      font-weight: bold;\n      z-index: 100;\n      display: none;\n      user-select: none;\n      text-align: center;\n      box-shadow: 0 0 20px rgba(0,0,0,0.5);\n      max-width: 90vw;\n      word-break: break-word;\n      cursor: pointer;\n    }\n    #message.show {\n      display: block;\n      animation: fadeIn 0.3s;\n    }\n    #message.win {\n      background: #2ed573;\n      color: white;\n    }\n    #message.lose {\n      background: #ff4757;\n      color: white;\n    }\n    @keyframes fadeIn {\n      from {\n        opacity: 0;\n        transform: translate(-50%, -50%) scale(0.8);\n      }\n      to {\n        opacity: 1;\n        transform: translate(-50%, -50%) scale(1);\n      }\n    }\n    @keyframes pulse {\n      0%, 100% {\n        transform: scale(1);\n      }\n      50% {\n        transform: scale(1.1);\n      }\n    }\n    @keyframes reveal {\n      from {\n        transform: scale(0.8);\n        opacity: 0;\n      }\n      to {\n        transform: scale(1);\n        opacity: 1;\n      }\n    }\n  </style>\n</head>\n<body>\n  <div class=\"container\">\n    <div class=\"header\">\n      <h1>Minesweeper</h1>\n      <div class=\"stats\">\n        <div class=\"stat\"><span class=\"stat-icon\">üí£</span><span id=\"mine-count\" class=\"stat-value\">40</span></div>\n        <div class=\"stat\"><span class=\"stat-icon\">‚è±Ô∏è</span><span id=\"timer\" class=\"stat-value\">00:00</span></div>\n      </div>\n    </div>\n    <div id=\"grid\" class=\"grid\"></div>\n    <div class=\"controls\">\n      <button id=\"new-game\">New Game</button>\n    </div>\n    <div id=\"message\"></div>\n  </div>\n  <script>\n    const GRID_SIZE = 16;\n    const MINE_COUNT = 40;\n    let grid = [];\n    let revealed = new Set();\n    let flagged = new Set();\n    let gameOver = false;\n    let gameWon = false;\n    let minesRemaining = MINE_COUNT;\n    let timerInterval = null;\n    let secondsElapsed = 0;\n    let firstClick = true;\n\n    const gridElement = document.getElementById('grid');\n    const mineCountElement = document.getElementById('mine-count');\n    const timerElement = document.getElementById('timer');\n    const messageElement = document.getElementById('message');\n    const newGameButton = document.getElementById('new-game');\n\n    function getNeighbors(row, col) {\n      const neighbors = [];\n      for (let dr = -1; dr <= 1; dr++) {\n        for (let dc = -1; dc <= 1; dc++) {\n          if (dr === 0 && dc === 0) continue;\n          const nr = row + dr, nc = col + dc;\n          if (nr >= 0 && nr < GRID_SIZE && nc >= 0 && nc < GRID_SIZE) {\n            neighbors.push([nr, nc]);\n          }\n        }\n      }\n      return neighbors;\n    }\n\n    function createGrid() {\n      grid = [];\n      for (let r = 0; r < GRID_SIZE; r++) {\n        grid[r] = [];\n        for (let c = 0; c < GRID_SIZE; c++) {\n          grid[r][c] = 0;\n        }\n      }\n      revealed.clear();\n      flagged.clear();\n      gameOver = false;\n      gameWon = false;\n      minesRemaining = MINE_COUNT;\n      firstClick = true;\n      secondsElapsed = 0;\n      updateMineCount();\n      updateTimer();\n      stopTimer();\n      messageElement.className = '';\n      messageElement.textContent = '';\n      messageElement.style.display = 'none';\n    }\n\n    function placeMines(excludeRow, excludeCol) {\n      let placed = 0;\n      while (placed < MINE_COUNT) {\n        const r = Math.floor(Math.random() * GRID_SIZE);\n        const c = Math.floor(Math.random() * GRID_SIZE);\n        if (grid[r][c] !== -1 && !(r === excludeRow && c === excludeCol)) {\n          grid[r][c] = -1;\n          placed++;\n        }\n      }\n    }\n\n    function calculateNumbers() {\n      for (let r = 0; r < GRID_SIZE; r++) {\n        for (let c = 0; c < GRID_SIZE; c++) {\n          if (grid[r][c] === -1) continue;\n          let count = 0;\n          for (const [nr, nc] of getNeighbors(r, c)) {\n            if (grid[nr][nc] === -1) count++;\n          }\n          grid[r][c] = count;\n        }\n      }\n    }\n\n    function getCellElement(row, col) {\n      return document.querySelector(`.cell[data-row=\"${row}\"][data-col=\"${col}\"]`);\n    }\n\n    function getCell(row, col) {\n      return getCellElement(row, col);\n    }\n\n    function revealCell(row, col) {\n      const key = row + ',' + col;\n      if (revealed.has(key) || flagged.has(key)) return;\n      \n      revealed.add(key);\n      const cell = getCell(row, col);\n      cell.classList.remove('hidden');\n      cell.classList.add('revealed');\n      \n      const count = grid[row][col];\n      if (count > 0) {\n        cell.textContent = count;\n        cell.classList.add('n' + count);\n      } else if (count === 0) {\n        cell.textContent = '';\n        for (const [nr, nc] of getNeighbors(row, col)) {\n          revealCell(nr, nc);\n        }\n      }\n    }\n\n    function revealMine(row, col) {\n      const cell = getCell(row, col);\n      cell.classList.remove('hidden');\n      cell.classList.add('mine');\n      cell.textContent = 'üí•';\n    }\n\n    function revealAllMines() {\n      for (let r = 0; r < GRID_SIZE; r++) {\n        for (let c = 0; c < GRID_SIZE; c++) {\n          if (grid[r][c] === -1) {\n            const cell = getCell(r, c);\n            cell.classList.remove('hidden', 'flagged');\n            cell.classList.add('mine');\n            cell.textContent = 'üí£';\n          }\n        }\n      }\n    }\n\n    function toggleFlag(row, col) {\n      if (gameOver) return;\n      const cellKey = `${row},${col}`;\n      if (revealed.has(cellKey)) return;\n      const cellElement = getCell(row, col);\n      if (flagged.has(cellKey)) {\n        flagged.delete(cellKey);\n        cellElement.classList.remove('flagged');\n        cellElement.classList.add('hidden');\n        cellElement.textContent = '';\n        minesRemaining++;\n      } else {\n        if (minesRemaining === 0) return;\n        flagged.add(cellKey);\n        cellElement.classList.remove('hidden');\n        cellElement.classList.add('flagged');\n        cellElement.textContent = 'üö©';\n        minesRemaining--;\n      }\n      updateMineCount();\n    }\n\n    function endGame(won) {\n      gameOver = true;\n      gameWon = won;\n      stopTimer();\n      \n      const msg = document.getElementById('message');\n      if (won) {\n        msg.textContent = 'üéâ You Win!';\n        msg.className = 'show win';\n      } else {\n        revealAllMines();\n        msg.textContent = 'üí• Game Over!';\n        msg.className = 'show lose';\n      }\n    }\n\n    function checkWin() {\n      const totalCells = GRID_SIZE * GRID_SIZE;\n      const nonMineCells = totalCells - MINE_COUNT;\n      if (revealed.size === nonMineCells) {\n        endGame(true);\n      }\n    }\n\n    function hideMessage() {\n      const msg = document.getElementById('message');\n      msg.className = '';\n      msg.textContent = '';\n      msg.style.display = 'none';\n    }\n\n    function handleClick(row, col) {\n      if (gameOver) return;\n      const key = row + ',' + col;\n      if (flagged.has(key) || revealed.has(key)) return;\n      \n      if (firstClick) {\n        firstClick = false;\n        placeMines(row, col);\n        calculateNumbers();\n        startTimer();\n      }\n      \n      if (grid[row][col] === -1) {\n        revealMine(row, col);\n        endGame(false);\n        return;\n      }\n      \n      revealCell(row, col);\n      checkWin();\n    }\n\n    function handleRightClick(row, col, e) {\n      e.preventDefault();\n      if (gameOver) return;\n      const key = row + ',' + col;\n      if (revealed.has(key)) return;\n      \n      const cell = getCell(row, col);\n      if (flagged.has(key)) {\n        flagged.delete(key);\n        cell.textContent = '';\n        cell.classList.remove('flagged');\n        minesRemaining++;\n      } else {\n        if (minesRemaining === 0) return;\n        flagged.add(key);\n        cell.textContent = 'üö©';\n        cell.classList.add('flagged');\n        minesRemaining--;\n      }\n      updateMineCount();\n    }\n\n    function renderGrid() {\n      const gridEl = document.getElementById('grid');\n      gridEl.innerHTML = '';\n      for (let r = 0; r < GRID_SIZE; r++) {\n        for (let c = 0; c < GRID_SIZE; c++) {\n          const cell = document.createElement('div');\n          cell.className = 'cell hidden';\n          cell.dataset.row = r;\n          cell.dataset.col = c;\n          cell.setAttribute('role', 'button');\n          cell.setAttribute('tabindex', '0');\n          cell.setAttribute('aria-label', 'Hidden cell');\n          cell.addEventListener('click', () => handleClick(r, c));\n          cell.addEventListener('contextmenu', (e) => handleRightClick(r, c, e));\n          cell.addEventListener('keydown', (e) => {\n            if (gameOver) return;\n            if (e.key === 'Enter' || e.key === ' ') {\n              e.preventDefault();\n              handleClick(r, c);\n            } else if (e.key.toLowerCase() === 'f') {\n              e.preventDefault();\n              if (firstClick) return;\n              toggleFlag(r, c);\n            }\n          });\n          gridEl.appendChild(cell);\n        }\n      }\n    }\n\n    function updateMineCount() {\n      mineCountElement.textContent = minesRemaining;\n    }\n\n    function formatTime(secs) {\n      const m = Math.floor(secs / 60).toString().padStart(2, '0');\n      const s = (secs % 60).toString().padStart(2, '0');\n      return m + ':' + s;\n    }\n\n    function updateTimer() {\n      timerElement.textContent = formatTime(secondsElapsed);\n    }\n\n    function startTimer() {\n      if (timerInterval) return;\n      timerInterval = setInterval(() => { secondsElapsed++; updateTimer(); }, 1000);\n    }\n\n    function stopTimer() {\n      if (timerInterval) { clearInterval(timerInterval); timerInterval = null; }\n    }\n\n    function initGame() {\n      grid = [];\n      revealed = new Set();\n      flagged = new Set();\n      gameOver = false;\n      gameWon = false;\n      minesRemaining = MINE_COUNT;\n      secondsElapsed = 0;\n      firstClick = true;\n      stopTimer();\n      updateTimer();\n      updateMineCount();\n      createGrid();\n      renderGrid();\n      hideMessage();\n    }\n\n    newGameButton.addEventListener('click', initGame);\n    messageElement.addEventListener('click', hideMessage);\n    document.addEventListener('DOMContentLoaded', initGame);\n  </script>\n</body>\n</html>",
      "samples": 1,
      "inputTokens": 4213,
      "outputTokens": 3832,
      "timeMs": 48247
    }
  ],
  "finalCode": "<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\" />\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\"/>\n  <title>Minesweeper</title>\n  <style>\n    * {\n      margin: 0;\n      padding: 0;\n      box-sizing: border-box;\n    }\n    body {\n      display: flex;\n      justify-content: center;\n      align-items: center;\n      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);\n      min-height: 100vh;\n      font-family: system-ui;\n    }\n    .container {\n      display: flex;\n      flex-direction: column;\n      align-items: center;\n      padding: 20px;\n      width: 100%;\n      max-width: 600px;\n    }\n    .header {\n      text-align: center;\n      margin-bottom: 20px;\n      color: white;\n      user-select: none;\n    }\n    h1 {\n      font-size: 2.5rem;\n      margin-bottom: 10px;\n      text-shadow: 0 0 10px cyan;\n    }\n    .stats {\n      display: flex;\n      gap: 30px;\n      font-size: 1.2rem;\n      justify-content: center;\n      margin-bottom: 10px;\n    }\n    .stat {\n      display: flex;\n      align-items: center;\n      gap: 8px;\n      color: white;\n    }\n    .stat-icon {\n      font-size: 1.3rem;\n      user-select: none;\n    }\n    .stat-value {\n      font-weight: bold;\n      min-width: 40px;\n      text-align: center;\n      font-family: monospace;\n      text-shadow: 0 0 5px rgba(255,255,255,0.3);\n    }\n    .grid {\n      display: grid;\n      grid-template-columns: repeat(16, 1fr);\n      gap: 2px;\n      background: #0f0f1a;\n      padding: 10px;\n      border-radius: 8px;\n      box-shadow: 0 0 20px rgba(0,255,255,0.1);\n      user-select: none;\n      width: 100%;\n      max-width: 448px;\n      transition: box-shadow 0.3s ease;\n    }\n    .grid:hover {\n      box-shadow: 0 0 30px rgba(0,255,255,0.2);\n    }\n    .cell {\n      width: 28px;\n      height: 28px;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      font-weight: bold;\n      cursor: pointer;\n      border-radius: 4px;\n      transition: all 0.15s;\n      user-select: none;\n      font-family: monospace;\n      font-size: 16px;\n      line-height: 1;\n      border: 1px solid rgba(255,255,255,0.05);\n    }\n    .cell.hidden {\n      background: linear-gradient(145deg, #3a3a5c, #2a2a4c);\n    }\n    .cell.hidden:hover {\n      background: #4a4a6c;\n      transform: scale(1.05);\n    }\n    .cell.revealed {\n      background: #1a1a2e;\n      cursor: default;\n      box-shadow: inset 0 0 5px #00000088;\n      color: inherit;\n      animation: reveal 0.2s ease-out;\n    }\n    .cell.flagged {\n      background: #4a3a5c;\n      color: #f1c40f;\n      cursor: pointer;\n      text-shadow: 0 0 3px #f1c40f;\n    }\n    .cell.mine {\n      background: #ff4757;\n      color: white;\n      cursor: default;\n      box-shadow: inset 0 0 5px #b03a47;\n      animation: pulse 0.5s ease-in-out;\n    }\n    .n1 { color: #3498db; }\n    .n2 { color: #2ecc71; }\n    .n3 { color: #e74c3c; }\n    .n4 { color: #9b59b6; }\n    .n5 { color: #e67e22; }\n    .n6 { color: #1abc9c; }\n    .n7 { color: #34495e; }\n    .n8 { color: #7f8c8d; }\n\n    .controls {\n      margin-top: 20px;\n      display: flex;\n      gap: 15px;\n      justify-content: center;\n      width: 100%;\n      max-width: 448px;\n    }\n    button {\n      padding: 12px 24px;\n      font-size: 1rem;\n      border: none;\n      border-radius: 6px;\n      cursor: pointer;\n      background: #4a4a7c;\n      color: white;\n      transition: all 0.2s;\n      user-select: none;\n      flex: 1;\n    }\n    button:hover {\n      background: #5a5a9c;\n      transform: translateY(-2px);\n    }\n    button:active {\n      transform: translateY(0);\n    }\n    #message {\n      position: fixed;\n      top: 50%;\n      left: 50%;\n      transform: translate(-50%, -50%);\n      padding: 30px 50px;\n      border-radius: 12px;\n      font-size: 2rem;\n      font-weight: bold;\n      z-index: 100;\n      display: none;\n      user-select: none;\n      text-align: center;\n      box-shadow: 0 0 20px rgba(0,0,0,0.5);\n      max-width: 90vw;\n      word-break: break-word;\n      cursor: pointer;\n    }\n    #message.show {\n      display: block;\n      animation: fadeIn 0.3s;\n    }\n    #message.win {\n      background: #2ed573;\n      color: white;\n    }\n    #message.lose {\n      background: #ff4757;\n      color: white;\n    }\n    @keyframes fadeIn {\n      from {\n        opacity: 0;\n        transform: translate(-50%, -50%) scale(0.8);\n      }\n      to {\n        opacity: 1;\n        transform: translate(-50%, -50%) scale(1);\n      }\n    }\n    @keyframes pulse {\n      0%, 100% {\n        transform: scale(1);\n      }\n      50% {\n        transform: scale(1.1);\n      }\n    }\n    @keyframes reveal {\n      from {\n        transform: scale(0.8);\n        opacity: 0;\n      }\n      to {\n        transform: scale(1);\n        opacity: 1;\n      }\n    }\n  </style>\n</head>\n<body>\n  <div class=\"container\">\n    <div class=\"header\">\n      <h1>Minesweeper</h1>\n      <div class=\"stats\">\n        <div class=\"stat\"><span class=\"stat-icon\">üí£</span><span id=\"mine-count\" class=\"stat-value\">40</span></div>\n        <div class=\"stat\"><span class=\"stat-icon\">‚è±Ô∏è</span><span id=\"timer\" class=\"stat-value\">00:00</span></div>\n      </div>\n    </div>\n    <div id=\"grid\" class=\"grid\"></div>\n    <div class=\"controls\">\n      <button id=\"new-game\">New Game</button>\n    </div>\n    <div id=\"message\"></div>\n  </div>\n  <script>\n    const GRID_SIZE = 16;\n    const MINE_COUNT = 40;\n    let grid = [];\n    let revealed = new Set();\n    let flagged = new Set();\n    let gameOver = false;\n    let gameWon = false;\n    let minesRemaining = MINE_COUNT;\n    let timerInterval = null;\n    let secondsElapsed = 0;\n    let firstClick = true;\n\n    const gridElement = document.getElementById('grid');\n    const mineCountElement = document.getElementById('mine-count');\n    const timerElement = document.getElementById('timer');\n    const messageElement = document.getElementById('message');\n    const newGameButton = document.getElementById('new-game');\n\n    function getNeighbors(row, col) {\n      const neighbors = [];\n      for (let dr = -1; dr <= 1; dr++) {\n        for (let dc = -1; dc <= 1; dc++) {\n          if (dr === 0 && dc === 0) continue;\n          const nr = row + dr, nc = col + dc;\n          if (nr >= 0 && nr < GRID_SIZE && nc >= 0 && nc < GRID_SIZE) {\n            neighbors.push([nr, nc]);\n          }\n        }\n      }\n      return neighbors;\n    }\n\n    function createGrid() {\n      grid = [];\n      for (let r = 0; r < GRID_SIZE; r++) {\n        grid[r] = [];\n        for (let c = 0; c < GRID_SIZE; c++) {\n          grid[r][c] = 0;\n        }\n      }\n      revealed.clear();\n      flagged.clear();\n      gameOver = false;\n      gameWon = false;\n      minesRemaining = MINE_COUNT;\n      firstClick = true;\n      secondsElapsed = 0;\n      updateMineCount();\n      updateTimer();\n      stopTimer();\n      messageElement.className = '';\n      messageElement.textContent = '';\n      messageElement.style.display = 'none';\n    }\n\n    function placeMines(excludeRow, excludeCol) {\n      let placed = 0;\n      while (placed < MINE_COUNT) {\n        const r = Math.floor(Math.random() * GRID_SIZE);\n        const c = Math.floor(Math.random() * GRID_SIZE);\n        if (grid[r][c] !== -1 && !(r === excludeRow && c === excludeCol)) {\n          grid[r][c] = -1;\n          placed++;\n        }\n      }\n    }\n\n    function calculateNumbers() {\n      for (let r = 0; r < GRID_SIZE; r++) {\n        for (let c = 0; c < GRID_SIZE; c++) {\n          if (grid[r][c] === -1) continue;\n          let count = 0;\n          for (const [nr, nc] of getNeighbors(r, c)) {\n            if (grid[nr][nc] === -1) count++;\n          }\n          grid[r][c] = count;\n        }\n      }\n    }\n\n    function getCellElement(row, col) {\n      return document.querySelector(`.cell[data-row=\"${row}\"][data-col=\"${col}\"]`);\n    }\n\n    function getCell(row, col) {\n      return getCellElement(row, col);\n    }\n\n    function revealCell(row, col) {\n      const key = row + ',' + col;\n      if (revealed.has(key) || flagged.has(key)) return;\n      \n      revealed.add(key);\n      const cell = getCell(row, col);\n      cell.classList.remove('hidden');\n      cell.classList.add('revealed');\n      \n      const count = grid[row][col];\n      if (count > 0) {\n        cell.textContent = count;\n        cell.classList.add('n' + count);\n      } else if (count === 0) {\n        cell.textContent = '';\n        for (const [nr, nc] of getNeighbors(row, col)) {\n          revealCell(nr, nc);\n        }\n      }\n    }\n\n    function revealMine(row, col) {\n      const cell = getCell(row, col);\n      cell.classList.remove('hidden');\n      cell.classList.add('mine');\n      cell.textContent = 'üí•';\n    }\n\n    function revealAllMines() {\n      for (let r = 0; r < GRID_SIZE; r++) {\n        for (let c = 0; c < GRID_SIZE; c++) {\n          if (grid[r][c] === -1) {\n            const cell = getCell(r, c);\n            cell.classList.remove('hidden', 'flagged');\n            cell.classList.add('mine');\n            cell.textContent = 'üí£';\n          }\n        }\n      }\n    }\n\n    function toggleFlag(row, col) {\n      if (gameOver) return;\n      const cellKey = `${row},${col}`;\n      if (revealed.has(cellKey)) return;\n      const cellElement = getCell(row, col);\n      if (flagged.has(cellKey)) {\n        flagged.delete(cellKey);\n        cellElement.classList.remove('flagged');\n        cellElement.classList.add('hidden');\n        cellElement.textContent = '';\n        minesRemaining++;\n      } else {\n        if (minesRemaining === 0) return;\n        flagged.add(cellKey);\n        cellElement.classList.remove('hidden');\n        cellElement.classList.add('flagged');\n        cellElement.textContent = 'üö©';\n        minesRemaining--;\n      }\n      updateMineCount();\n    }\n\n    function endGame(won) {\n      gameOver = true;\n      gameWon = won;\n      stopTimer();\n      \n      const msg = document.getElementById('message');\n      if (won) {\n        msg.textContent = 'üéâ You Win!';\n        msg.className = 'show win';\n      } else {\n        revealAllMines();\n        msg.textContent = 'üí• Game Over!';\n        msg.className = 'show lose';\n      }\n    }\n\n    function checkWin() {\n      const totalCells = GRID_SIZE * GRID_SIZE;\n      const nonMineCells = totalCells - MINE_COUNT;\n      if (revealed.size === nonMineCells) {\n        endGame(true);\n      }\n    }\n\n    function hideMessage() {\n      const msg = document.getElementById('message');\n      msg.className = '';\n      msg.textContent = '';\n      msg.style.display = 'none';\n    }\n\n    function handleClick(row, col) {\n      if (gameOver) return;\n      const key = row + ',' + col;\n      if (flagged.has(key) || revealed.has(key)) return;\n      \n      if (firstClick) {\n        firstClick = false;\n        placeMines(row, col);\n        calculateNumbers();\n        startTimer();\n      }\n      \n      if (grid[row][col] === -1) {\n        revealMine(row, col);\n        endGame(false);\n        return;\n      }\n      \n      revealCell(row, col);\n      checkWin();\n    }\n\n    function handleRightClick(row, col, e) {\n      e.preventDefault();\n      if (gameOver) return;\n      const key = row + ',' + col;\n      if (revealed.has(key)) return;\n      \n      const cell = getCell(row, col);\n      if (flagged.has(key)) {\n        flagged.delete(key);\n        cell.textContent = '';\n        cell.classList.remove('flagged');\n        minesRemaining++;\n      } else {\n        if (minesRemaining === 0) return;\n        flagged.add(key);\n        cell.textContent = 'üö©';\n        cell.classList.add('flagged');\n        minesRemaining--;\n      }\n      updateMineCount();\n    }\n\n    function renderGrid() {\n      const gridEl = document.getElementById('grid');\n      gridEl.innerHTML = '';\n      for (let r = 0; r < GRID_SIZE; r++) {\n        for (let c = 0; c < GRID_SIZE; c++) {\n          const cell = document.createElement('div');\n          cell.className = 'cell hidden';\n          cell.dataset.row = r;\n          cell.dataset.col = c;\n          cell.setAttribute('role', 'button');\n          cell.setAttribute('tabindex', '0');\n          cell.setAttribute('aria-label', 'Hidden cell');\n          cell.addEventListener('click', () => handleClick(r, c));\n          cell.addEventListener('contextmenu', (e) => handleRightClick(r, c, e));\n          cell.addEventListener('keydown', (e) => {\n            if (gameOver) return;\n            if (e.key === 'Enter' || e.key === ' ') {\n              e.preventDefault();\n              handleClick(r, c);\n            } else if (e.key.toLowerCase() === 'f') {\n              e.preventDefault();\n              if (firstClick) return;\n              toggleFlag(r, c);\n            }\n          });\n          gridEl.appendChild(cell);\n        }\n      }\n    }\n\n    function updateMineCount() {\n      mineCountElement.textContent = minesRemaining;\n    }\n\n    function formatTime(secs) {\n      const m = Math.floor(secs / 60).toString().padStart(2, '0');\n      const s = (secs % 60).toString().padStart(2, '0');\n      return m + ':' + s;\n    }\n\n    function updateTimer() {\n      timerElement.textContent = formatTime(secondsElapsed);\n    }\n\n    function startTimer() {\n      if (timerInterval) return;\n      timerInterval = setInterval(() => { secondsElapsed++; updateTimer(); }, 1000);\n    }\n\n    function stopTimer() {\n      if (timerInterval) { clearInterval(timerInterval); timerInterval = null; }\n    }\n\n    function initGame() {\n      grid = [];\n      revealed = new Set();\n      flagged = new Set();\n      gameOver = false;\n      gameWon = false;\n      minesRemaining = MINE_COUNT;\n      secondsElapsed = 0;\n      firstClick = true;\n      stopTimer();\n      updateTimer();\n      updateMineCount();\n      createGrid();\n      renderGrid();\n      hideMessage();\n    }\n\n    newGameButton.addEventListener('click', initGame);\n    messageElement.addEventListener('click', hideMessage);\n    document.addEventListener('DOMContentLoaded', initGame);\n  </script>\n</body>\n</html>",
  "totalSteps": 17,
  "completed": true,
  "totalTimeMs": 545558,
  "totalInputTokens": 47696,
  "totalOutputTokens": 42329,
  "estimatedCost": 0.0868048
}